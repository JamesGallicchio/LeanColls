<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Mathlib.Tactic.Variable</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Mathlib.Tactic.Variable";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">Variable</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Mathlib/Init.html">Mathlib.Init</a></li><li><a href="../.././Lean/Meta/Tactic/TryThis.html">Lean.Meta.Tactic.TryThis</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Mathlib.Tactic.Variable" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.variable?.maxSteps"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span>.<span class="name">maxSteps</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.variable?.checkRedundant"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span>.<span class="name">checkRedundant</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.bracketedBinderType"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">bracketedBinderType</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.variable?"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.variableAliasAttr"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variableAliasAttr</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.pendingActionableSynthMVar"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">pendingActionableSynthMVar</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.getSubproblem"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">getSubproblem</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.completeBinders'"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders'</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.completeBinders'.isVariableAlias"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders'</span>.<span class="name">isVariableAlias</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.completeBinders"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.cleanBinders"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">cleanBinders</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.elabVariables"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.elabVariables.extendScope"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span>.<span class="name">extendScope</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.elabVariables.process"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span>.<span class="name">process</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Command.Variable.ignorevariable?"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">ignorevariable?</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="The-variable-command">The <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command <a class="hover-link" href="#The-variable-command">#</a></h1><p>This defines a command like <code>variable</code> that automatically adds all missing typeclass
arguments. For example, <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> [Module R M]</code> is the same as
<code>variable [Semiring R] [AddCommMonoid M] [Module R M]</code>, though if any of these three instance
arguments can be inferred from previous variables then they will be omitted.</p><p>An inherent limitation with this command is that variables are recorded in the scope as
<em>syntax</em>. This means that <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> needs to pretty print the expressions we get
from typeclass synthesis errors, and these might fail to round trip.</p></div><div class="decl" id="Mathlib.Command.Variable.variable?.maxSteps"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L27-L31">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?.maxSteps"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span>.<span class="name">maxSteps</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Mathlib.Command.Variable.variable?.checkRedundant"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L33-L36">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?.checkRedundant"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span>.<span class="name">checkRedundant</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Mathlib.Command.Variable.bracketedBinderType"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L39-L44">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.bracketedBinderType"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">bracketedBinderType</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Meta.html#Lean.Syntax.Term">Lean.Term</a></span></span></div></div><p>Get the type out of a bracketed binder.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.bracketedBinderType" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.variable?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L46-L82">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variable?</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.ParserDescr">Lean.ParserDescr</a></div></div><p>The <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command has the same syntax as <code>variable</code>, but it will auto-insert
missing instance arguments wherever they are needed.
It does not add variables that can already be deduced from others in the current context.
By default the command checks that variables aren't implied by earlier ones, but it does <em>not</em>
check that earlier variables aren't implied by later ones.
Unlike <code>variable</code>, the <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command does not support changing variable binder types.</p><p>The <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command will give a suggestion to replace itself with a command of the form
<code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> ...binders... =&gt; ...binders...</code>.  The binders after the <code>=&gt;</code> are the completed
list of binders. When this <code>=&gt;</code> clause is present, the command verifies that the expanded
binders match the post-<code>=&gt;</code> binders.  The purpose of this is to help keep code that uses
<code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> resilient against changes to the typeclass hierarchy, at least in the sense
that this additional information can be used to debug issues that might arise.
One can also replace <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> ...binders... =&gt;</code> with <code>variable</code>.</p><p>The core algorithm is to try elaborating binders one at a time, and whenever there is a
typeclass instance inference failure, it synthesizes binder syntax for it and adds it to
the list of binders and tries again, recursively. There are no guarantees that this
process gives the &quot;correct&quot; list of binders.</p><p>Structures tagged with the <code>variable_alias</code> attribute can serve as aliases for a collection
of typeclasses. For example, given</p><pre><code class="language-lean">@[variable_alias]
structure VectorSpace (k V : Type*) [Field k] [AddCommGroup V] [Module k V]
</code></pre><p>then <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> [VectorSpace k V]</code> is
equivalent to <code>variable {k V : Type*} [Field k] [AddCommGroup V] [Module k V]</code>, assuming
that there are no pre-existing instances on <code>k</code> and <code>V</code>.
Note that this is not a simple replacement: it only adds instances not inferrable
from others in the current scope.</p><p>A word of warning: the core algorithm depends on pretty printing, so if terms that appear
in binders do not round trip, this algorithm can fail. That said, it has some support
for quantified binders such as <code>[∀ i, F i]</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.variable?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.variableAliasAttr"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L84-L102">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variableAliasAttr"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">variableAliasAttr</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Attributes.html#Lean.TagAttribute">Lean.TagAttribute</a></div></div><p>Attribute to record aliases for the <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command. Aliases are structures that have no
fields, and additional typeclasses are recorded as <em>arguments</em> to the structure.</p><p>Example:</p><pre><code>@[variable_alias]
structure VectorSpace (k V : Type*)
  [Field k] [AddCommGroup V] [Module k V]
</code></pre><p>Then <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> [VectorSpace k V]</code> ensures that these three typeclasses are present in
the current scope. Notice that it's looking at the arguments to the <code>VectorSpace</code> type
constructor. You should not have any fields in <code>variable_alias</code> structures.</p><p>Notice that <code>VectorSpace</code> is not a class; the <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command allows non-classes with the
<code>variable_alias</code> attribute to use instance binders.</p></div></div><div class="decl" id="Mathlib.Command.Variable.pendingActionableSynthMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L105-L118">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.pendingActionableSynthMVar"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">pendingActionableSynthMVar</span></a></span><span class="decl_args">
<span class="fn">(binder : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntax">Lean.TSyntax</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Term.html#Lean.Elab.Term.TermElabM">Lean.Elab.TermElabM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span></div></div><p>Find a synthetic typeclass metavariable with no expr metavariables in its type.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.pendingActionableSynthMVar" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.getSubproblem"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L123-L150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.getSubproblem"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">getSubproblem</span></a></span><span class="decl_args">
<span class="fn">(binder : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntax">Lean.TSyntax</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(ty : <a href="../.././Init/Meta.html#Lean.Syntax.Term">Lean.Term</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Term.html#Lean.Elab.Term.TermElabM">Lean.Elab.TermElabM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Lean/Message.html#Lean.MessageData">Lean.MessageData</a> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntax">Lean.TSyntax</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span>)</span></span></div></div><p>Try elaborating <code>ty</code>. Returns <code>none</code> if it doesn't need any additional typeclasses,
or it returns a new binder that needs to come first. Does not add info unless it throws
an exception.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.getSubproblem" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.completeBinders'"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L157-L228">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.completeBinders'"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders'</span></a></span><span class="decl_args">
<span class="fn">(maxSteps : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(gas : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(checkRedundant : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(binders : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(toOmit : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(i : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Term.html#Lean.Elab.Term.TermElabM">Lean.Elab.TermElabM</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span></div></div><p>Tries elaborating binders, inserting new binders whenever typeclass inference fails.
<code>i</code> is the index of the next binder that needs to be checked.</p><p>The <code>toOmit</code> array keeps track of which binders should be removed at the end,
in particular the <code>variable_alias</code> binders and any redundant binders.</p></div></div><div class="decl" id="Mathlib.Command.Variable.completeBinders'.isVariableAlias"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L223-L228">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.completeBinders'.isVariableAlias"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders'</span>.<span class="name">isVariableAlias</span></a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.completeBinders'.isVariableAlias" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.completeBinders"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L230-L233">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.completeBinders"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">completeBinders</span></a></span><span class="decl_args">
<span class="fn">(maxSteps : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(checkRedundant : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(binders : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Term.html#Lean.Elab.Term.TermElabM">Lean.Elab.TermElabM</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.completeBinders">Mathlib.Command.Variable.completeBinders</a> <span class="fn">maxSteps</span> <span class="fn">checkRedundant</span> <span class="fn">binders</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.completeBinders'">Mathlib.Command.Variable.completeBinders'</a> <span class="fn">maxSteps</span> <span class="fn">maxSteps</span> <span class="fn">checkRedundant</span> <span class="fn">binders</span> <span class="fn">#[]</span> <span class="fn">0</span></span></span></li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.completeBinders" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.cleanBinders"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L236-L241">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.cleanBinders"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">cleanBinders</span></a></span><span class="decl_args">
<span class="fn">(binders : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span></div></div><p>Strip off whitespace and comments.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.cleanBinders" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.elabVariables"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L244-L304">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.elabVariables"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.CommandElab">Lean.Elab.Command.CommandElab</a></div></div><p>The <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command has the same syntax as <code>variable</code>, but it will auto-insert
missing instance arguments wherever they are needed.
It does not add variables that can already be deduced from others in the current context.
By default the command checks that variables aren't implied by earlier ones, but it does <em>not</em>
check that earlier variables aren't implied by later ones.
Unlike <code>variable</code>, the <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command does not support changing variable binder types.</p><p>The <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> command will give a suggestion to replace itself with a command of the form
<code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> ...binders... =&gt; ...binders...</code>.  The binders after the <code>=&gt;</code> are the completed
list of binders. When this <code>=&gt;</code> clause is present, the command verifies that the expanded
binders match the post-<code>=&gt;</code> binders.  The purpose of this is to help keep code that uses
<code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a></code> resilient against changes to the typeclass hierarchy, at least in the sense
that this additional information can be used to debug issues that might arise.
One can also replace <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> ...binders... =&gt;</code> with <code>variable</code>.</p><p>The core algorithm is to try elaborating binders one at a time, and whenever there is a
typeclass instance inference failure, it synthesizes binder syntax for it and adds it to
the list of binders and tries again, recursively. There are no guarantees that this
process gives the &quot;correct&quot; list of binders.</p><p>Structures tagged with the <code>variable_alias</code> attribute can serve as aliases for a collection
of typeclasses. For example, given</p><pre><code class="language-lean">@[variable_alias]
structure VectorSpace (k V : Type*) [Field k] [AddCommGroup V] [Module k V]
</code></pre><p>then <code><a href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.variable?">variable?</a> [VectorSpace k V]</code> is
equivalent to <code>variable {k V : Type*} [Field k] [AddCommGroup V] [Module k V]</code>, assuming
that there are no pre-existing instances on <code>k</code> and <code>V</code>.
Note that this is not a simple replacement: it only adds instances not inferrable
from others in the current scope.</p><p>A word of warning: the core algorithm depends on pretty printing, so if terms that appear
in binders do not round trip, this algorithm can fail. That said, it has some support
for quantified binders such as <code>[∀ i, F i]</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.elabVariables" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.elabVariables.extendScope"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L251-L256">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.elabVariables.extendScope"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span>.<span class="name">extendScope</span></a></span><span class="decl_args">
<span class="fn">(binders : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.CommandElabM">Lean.Elab.Command.CommandElabM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.elabVariables.extendScope" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.elabVariables.process"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L257-L304">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.elabVariables.process"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">elabVariables</span>.<span class="name">process</span></a></span><span class="decl_args">
<span class="fn">(stx : <a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>)</span></span>
<span class="decl_args">
<span class="fn">(checkRedundant : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(binders : <span class="fn"><a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(expectedBinders? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Init/Prelude.html#Lean.TSyntaxArray">Lean.TSyntaxArray</a> <span class="fn">`Lean.Parser.Term.bracketedBinder</span>)</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.CommandElabM">Lean.Elab.Command.CommandElabM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.elabVariables.process" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Command.Variable.ignorevariable?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/20c73142afa995ac9c8fb80a9bb585a55ca38308/Mathlib/Tactic/Variable.lean#L308-L310">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Mathlib/Tactic/Variable.html#Mathlib.Command.Variable.ignorevariable?"><span class="name">Mathlib</span>.<span class="name">Command</span>.<span class="name">Variable</span>.<span class="name">ignorevariable?</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">Lean.Linter.IgnoreFunction</a></div></div><p>Hint for the unused variables linter. Copies the one for <code>variable</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Command.Variable.ignorevariable?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>