<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Language.Basic</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Language.Basic";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Basic</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Message.html">Lean.Message</a></li><li><a href="../.././Init/System/Promise.html">Init.System.Promise</a></li><li><a href="../.././Lean/Elab/InfoTree.html">Lean.Elab.InfoTree</a></li><li><a href="../.././Lean/Parser/Types.html">Lean.Parser.Types</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Language.Basic" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics.empty"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">empty</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instNonemptySnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.ofIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ofIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.pure"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">pure</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.cancel"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">cancel</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.map"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">map</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.bind"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.bindIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bindIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.get"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.get?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SyntaxGuarded"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SyntaxGuarded</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotBundle"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotBundle</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.withAlwaysResolvedPromise"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withAlwaysResolvedPromise</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.withAlwaysResolvedPromises"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withAlwaysResolvedPromises</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.element"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">element</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.children"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">children</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.format"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">format</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.format.go"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">format</span>.<span class="name">go</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ToSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ToSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeOption"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeOption</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instNonemptySnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instTypeNameSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeDynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot.ofTyped"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">ofTyped</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot.toTyped?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">toTyped?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedDynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.forM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">forM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.printMessageEndPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">printMessageEndPos</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.reportMessages"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">reportMessages</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.runAndReport"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">runAndReport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.getAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">getAll</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingContext"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingT"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingT</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instMonadLiftProcessingMProcessingTIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instMonadLiftProcessingMProcessingTIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics.ofMessageLog"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">ofMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.diagnosticsOfHeaderError"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">diagnosticsOfHeaderError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.withHeaderExceptions"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withHeaderExceptions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.mkIncrementalProcessor"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">mkIncrementalProcessor</span></a></div></nav><main>
<div class="decl" id="Lean.Language.Snapshot.Diagnostics"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L26-L38">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p><code>MessageLog</code> with interactive diagnostics.</p><p>Can be created using <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty">Diagnostics.empty</a></code> or <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog">Diagnostics.ofMessageLog</a></code>.</p><ul class="structure_fields" id="_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk"><li id="Lean.Language.Snapshot.Diagnostics.msgLog" class="structure_field"><div class="structure_field_info">msgLog : <a href="../.././Lean/Message.html#Lean.MessageLog">Lean.MessageLog</a></div><div class="structure_field_doc"><p>Non-interactive message log.</p></div></li><li id="Lean.Language.Snapshot.Diagnostics.interactiveDiagsRef?" class="structure_field"><div class="structure_field_info">interactiveDiagsRef? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a>)</span>)</span></span></div><div class="structure_field_doc"><p>Dynamic mutable slot usable by the language server for memorizing interactive diagnostics. If
<code>none</code>, interactive diagnostics are not remembered, which should only be used for messages not
containing any interactive elements as client-side state will be lost on recreating a diagnostic.</p><p>See also section &quot;Communication&quot; in Lean/Server/README.md.</p></div></li></ul><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.instInhabitedDiagnostics"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Lean.Language.Snapshot.Diagnostics</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics">Lean.Language.Snapshot.instInhabitedDiagnostics</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">msgLog</span> := <span class="fn">default</span>, <span class="fn">interactiveDiagsRef?</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.Diagnostics.empty"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L41-L44">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">empty</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Lean.Language.Snapshot.Diagnostics</a></div></div><p>The empty set of diagnostics.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty">Lean.Language.Snapshot.Diagnostics.empty</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">msgLog</span> := <a href="../.././Lean/Message.html#Lean.MessageLog.empty">Lean.MessageLog.empty</a>, <span class="fn">interactiveDiagsRef?</span> := <span class="fn">none</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics.empty" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L49-L63">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>The base class of all snapshots: all the generic information the language server needs about a
snapshot.</p><ul class="structure_fields" id="Lean.Language.Snapshot.mk"><li id="Lean.Language.Snapshot.desc" class="structure_field"><div class="structure_field_info">desc : <a href="../.././Init/Prelude.html#String">String</a></div><div class="structure_field_doc"><p>Debug description shown by <code>trace.Elab.snapshotTree</code>, defaults to the caller's decl name.</p></div></li><li id="Lean.Language.Snapshot.diagnostics" class="structure_field"><div class="structure_field_info">diagnostics : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Lean.Language.Snapshot.Diagnostics</a></div><div class="structure_field_doc"><p>The messages produced by this step. The union of message logs of all finished snapshots is
reported to the user.</p></div></li><li id="Lean.Language.Snapshot.infoTree?" class="structure_field"><div class="structure_field_info">infoTree? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Lean.Elab.InfoTree</a></span></div><div class="structure_field_doc"><p>General elaboration metadata produced by this step.</p></div></li><li id="Lean.Language.Snapshot.isFatal" class="structure_field"><div class="structure_field_info">isFatal : <a href="../.././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Whether it should be indicated to the user that a fatal error (which should be part of
<code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.diagnostics">diagnostics</a></code>) occurred that prevents processing of the remainder of the file.</p></div></li></ul><details id="instances-for-list-Lean.Language.Snapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L63-L63">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot">Lean.Language.instInhabitedSnapshot</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">desc</span> := <span class="fn">default</span>, <span class="fn">diagnostics</span> := <span class="fn">default</span>, <span class="fn">infoTree?</span> := <span class="fn">default</span>, <span class="fn">isFatal</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L69-L77">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>A task producing some snapshot type (usually a subclass of <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></code>).</p><ul class="structure_fields" id="Lean.Language.SnapshotTask.mk"><li id="Lean.Language.SnapshotTask.range?" class="structure_field"><div class="structure_field_info">range? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a></span></div><div class="structure_field_doc"><p>Range that is marked as being processed by the server while the task is running. If <code>none</code>,
the range of the outer task if some or else the entire file is reported.</p></div></li><li id="Lean.Language.SnapshotTask.task" class="structure_field"><div class="structure_field_info">task : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">α</span></span></div><div class="structure_field_doc"><p>Underlying task producing the snapshot.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instNonemptySnapshotTask"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L77-L77">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instNonemptySnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotTask</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">∀ {<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>} [<span class="fn">inst</span> : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">α</span></span>], <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span>)</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">⋯</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">⋯</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTask"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L77-L77">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">{<span class="fn">a</span> : <a href="../.././foundational_types.html">Type</a>} → <span class="fn">[<span class="fn">inst</span> : <span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">a</span></span>] → <span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">a</span>)</span></span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.Language.instInhabitedSnapshotTask</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">range?</span> := <span class="fn">default</span>, <span class="fn">task</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.ofIO"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L80-L84">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ofIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ofIO</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(range? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span>)</span></span></div></div><p>Creates a snapshot task from a reporting range and a <code><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a></code> action.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ofIO">Lean.Language.SnapshotTask.ofIO</a> <span class="fn">range?</span> <span class="fn">act</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><span class="fn">act</span>.asTask</span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">{ <span class="fn">range?</span> := <span class="fn">range?</span>, <span class="fn">task</span> := <span class="fn">__do_lift</span> }</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.ofIO" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.pure"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L87-L90">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.pure"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">pure</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(a : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span></div></div><p>Creates a finished snapshot task.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.pure">Lean.Language.SnapshotTask.pure</a> <span class="fn">a</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">range?</span> := <span class="fn">none</span>, <span class="fn">task</span> := <span class="fn">{ <span class="fn">get</span> := <span class="fn">a</span> }</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.pure" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.cancel"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L95-L96">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.cancel"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">cancel</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Explicitly cancels a tasks. Like with basic <code>Tasks</code>s, cancellation happens implicitly when the
last reference to the task is dropped <em>if</em> it is not an I/O task.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">t</span>.cancel</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.cancel">IO.cancel</a> <span class="fn"><span class="fn">t</span>.task</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.cancel" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.map"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L99-L101">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.map"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">map</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">α</span> → <span class="fn">β</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(range? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a>)</span> <span class="fn"><span class="fn">t</span>.range?</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(sync : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">β</span></span></div></div><p>Transforms a task's output without changing the reporting range.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">t</span>.map</span> <span class="fn">f</span> <span class="fn">range?</span> <span class="fn">sync</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">range?</span> := <span class="fn">range?</span>, <span class="fn">task</span> := <span class="fn"><a href="../.././Init/Core.html#Task.map">Task.map</a> <span class="fn">f</span> <span class="fn"><span class="fn">t</span>.task</span> <a href="../.././Init/Core.html#Task.Priority.default">Task.Priority.default</a> <span class="fn">sync</span></span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.map" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.bind"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L106-L108">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.bind"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bind</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">β</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(range? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a>)</span> <span class="fn"><span class="fn">t</span>.range?</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(sync : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">β</span></span></div></div><p>Chains two snapshot tasks. The range is taken from the first task if not specified; the range of
the second task is discarded.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">t</span>.bind</span> <span class="fn">act</span> <span class="fn">range?</span> <span class="fn">sync</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">range?</span> := <span class="fn">range?</span>, <span class="fn">task</span> := <span class="fn"><span class="fn"><span class="fn"><span class="fn">t</span>.task</span>.bind</span> <span class="fn">(fun (<span class="fn">x</span> : <span class="fn">α</span>) =&gt; <span class="fn"><span class="fn">(<span class="fn">act</span> <span class="fn">x</span>)</span>.task</span>)</span> <a href="../.././Init/Core.html#Task.Priority.default">Task.Priority.default</a> <span class="fn">sync</span></span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.bind" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.bindIO"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L113-L118">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.bindIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bindIO</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">β</span>)</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(range? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a>)</span> <span class="fn"><span class="fn">t</span>.range?</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(sync : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">β</span>)</span></span></div></div><p>Chains two snapshot tasks. The range is taken from the first task if not specified; the range of
the second task is discarded.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.bindIO" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.get"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L121-L122">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">α</span></div></div><p>Synchronously waits on the result of the task.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">t</span>.get</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">t</span>.task</span>.get</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.get" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.get?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L125-L126">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get?</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span>)</span></span></div></div><p>Returns task result if already finished or else <code>none</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">t</span>.get?</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/IO.html#IO.hasFinished">IO.hasFinished</a> <span class="fn"><span class="fn">t</span>.task</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(if <span class="fn"><span class="fn">__do_lift</span> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn"><span class="fn"><span class="fn">t</span>.task</span>.get</span></span> else <span class="fn">none</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.get?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SyntaxGuarded"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L131-L135">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SyntaxGuarded</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Arbitrary value paired with a syntax that should be inspected when considering the value for reuse.</p><ul class="structure_fields" id="Lean.Language.SyntaxGuarded.mk"><li id="Lean.Language.SyntaxGuarded.stx" class="structure_field"><div class="structure_field_info">stx : <a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a></div><div class="structure_field_doc"><p>Syntax to be inspected for reuse.</p></div></li><li id="Lean.Language.SyntaxGuarded.val" class="structure_field"><div class="structure_field_info">val : <span class="fn">α</span></div><div class="structure_field_doc"><p>Potentially reusable value.</p></div></li></ul><details id="instances-for-list-Lean.Language.SyntaxGuarded" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotBundle"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L149-L159">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotBundle</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Pair of (optional) old snapshot task usable for incremental reuse and new snapshot promise for
incremental reporting. Inside the elaborator, we build snapshots by carrying such bundles and then
checking if we can reuse <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.old?">old?</a></code> if set or else redoing the corresponding elaboration step. In either
case, we derive new bundles for nested snapshots, if any, and finally <code>resolve</code> <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.new">new</a></code> to the result.</p><p>Note that failing to <code>resolve</code> a created promise will block the language server indefinitely!
We use <code><a href="../.././Lean/Language/Basic.html#Lean.Language.withAlwaysResolvedPromise">withAlwaysResolvedPromise</a></code>/<code><a href="../.././Lean/Language/Basic.html#Lean.Language.withAlwaysResolvedPromises">withAlwaysResolvedPromises</a></code> to ensure this doesn't happen.</p><p>In the future, the 1-element history <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.old?">old?</a></code> may be replaced with a global cache indexed by strong
hashes but the promise will still need to be passed through the elaborator.</p><ul class="structure_fields" id="Lean.Language.SnapshotBundle.mk"><li id="Lean.Language.SnapshotBundle.old?" class="structure_field"><div class="structure_field_info">old? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded">Lean.Language.SyntaxGuarded</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <span class="fn">α</span>)</span>)</span></span></div><div class="structure_field_doc"><p>Snapshot task of corresponding elaboration in previous document version if any, paired with its
old syntax to be considered for reuse. Should be set to <code>none</code> as soon as reuse can be ruled out.</p></div></li><li id="Lean.Language.SnapshotBundle.new" class="structure_field"><div class="structure_field_info">new : <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">α</span></span></div><div class="structure_field_doc"><p>Promise of snapshot value for the current document. When resolved, the language server will
report its result even before the current elaborator invocation has finished.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotBundle" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.withAlwaysResolvedPromise"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L167-L173">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.withAlwaysResolvedPromise"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withAlwaysResolvedPromise</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadLiftT">MonadLiftT</a> <a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Control/Except.html#MonadFinally">MonadFinally</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(act : <span class="fn"><span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">α</span></span> → <span class="fn"><span class="fn">m</span> <span class="fn">β</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">β</span></span></div></div><p>Runs <code>act</code> with a newly created promise and finally resolves it to <code>default</code> if not done by <code>act</code>.</p><p>Always resolving promises involved in the snapshot tree is important to avoid deadlocking the
language server.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.withAlwaysResolvedPromise">Lean.Language.withAlwaysResolvedPromise</a> <span class="fn">act</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">p</span> ← <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">IO.Promise.new</span></span>
  <span class="fn"><a href="../.././Init/Control/Except.html#tryFinally">tryFinally</a> <span class="fn">(<span class="fn">act</span> <span class="fn">p</span>)</span> <span class="fn">(<a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href="../.././Init/System/Promise.html#IO.Promise.resolve">IO.Promise.resolve</a> <span class="fn">default</span> <span class="fn">p</span>)</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.withAlwaysResolvedPromise" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.withAlwaysResolvedPromises"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L182-L189">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.withAlwaysResolvedPromises"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withAlwaysResolvedPromises</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadLiftT">MonadLiftT</a> <a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Control/Except.html#MonadFinally">MonadFinally</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(count : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">α</span>)</span></span> → <span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Runs <code>act</code> with <code>count</code> newly created promises and finally resolves them to <code>default</code> if not done by
<code>act</code>.</p><p>Always resolving promises involved in the snapshot tree is important to avoid deadlocking the
language server.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.withAlwaysResolvedPromises" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L196-L199">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Tree of snapshots where each snapshot comes with an array of asynchronous further subtrees. Used
for asynchronously collecting information about the entirety of snapshots in the language server.
The involved tasks may form a DAG on the <code><a href="../.././Init/Core.html#Task">Task</a></code> dependency level but this is not captured by this
data structure.</p><ul class="constructors"><li class="constructor" id="Lean.Language.SnapshotTree.mk">mk: <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a> → <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span> → <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a></span></span><div class="inductive_ctor_doc"><p>Creates a snapshot tree node.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotTree" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTree"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L199-L199">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree">Lean.Language.instInhabitedSnapshotTree</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">Lean.Language.SnapshotTree.mk</a> <span class="fn">default</span> <span class="fn">default</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.element"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L202-L203">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.element"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">element</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a> → <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a></span></div></div><p>The immediately available element of the snapshot tree node.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">x</span>.element</span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">Lean.Language.SnapshotTree.mk</a> <span class="fn">s</span> <span class="fn">children</span></span> =&gt; <span class="fn">s</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.element" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.children"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L205-L206">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.children"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">children</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a> → <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span></span></div></div><p>The asynchronously available children of the snapshot tree node.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">x</span>.children</span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">Lean.Language.SnapshotTree.mk</a> <span class="fn">element</span> <span class="fn">children</span></span> =&gt; <span class="fn">children</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.children" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.format"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L209-L221">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.format"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">format</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Position.html#Lean.MonadFileMap">Lean.MonadFileMap</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadLiftT">MonadLiftT</a> <a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a> → <span class="fn"><span class="fn">m</span> <a href="../.././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></span></div></div><p>Produces debug tree format of given snapshot tree, synchronously waiting on all children.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.Language.SnapshotTree.format</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.format.go">Lean.Language.SnapshotTree.format.go</a> <span class="fn">none</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.format" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.format.go"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L212-L221">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.format.go"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">format</span>.<span class="name">go</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Position.html#Lean.MonadFileMap">Lean.MonadFileMap</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadLiftT">MonadLiftT</a> <a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(range? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(s : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></div></div></div></div><div class="decl" id="Lean.Language.ToSnapshotTree"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L226-L228">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ToSnapshotTree</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Helper class for projecting a heterogeneous hierarchy of snapshot classes to a homogeneous
representation.</p><ul class="structure_fields" id="Lean.Language.ToSnapshotTree.mk"><li id="Lean.Language.ToSnapshotTree.toSnapshotTree" class="structure_field"><div class="structure_field_info">toSnapshotTree : <span class="fn"><span class="fn">α</span> → <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a></span></div><div class="structure_field_doc"><p>Transforms a language-specific snapshot to a homogeneous snapshot tree.</p></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.Language.ToSnapshotTree" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeOption"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L231-L234">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeOption"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeOption</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">Lean.Language.ToSnapshotTree</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">Lean.Language.ToSnapshotTree</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.Language.instToSnapshotTreeOption</span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{
    <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span>) =&gt;
      <span class="fn">match <span class="fn">x</span> with
      | <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">a</span></span> =&gt; <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.toSnapshotTree">Lean.Language.toSnapshotTree</a> <span class="fn">a</span></span>
      | <span class="fn">none</span> =&gt; <span class="fn">default</span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotLeaf"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L237-L238">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotLeaf</span></a></span><span class="decl_extends">extends</span><span class="decl_parent">
<span class="fn"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span></a></span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Snapshot type without child nodes.</p><ul class="structure_fields" id="Lean.Language.SnapshotLeaf.mk"></ul><details id="instances-for-list-Lean.Language.SnapshotLeaf" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instNonemptySnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L238-L238">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instNonemptySnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">Lean.Language.SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instNonemptySnapshotLeaf">Lean.Language.instNonemptySnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">⋯</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.instTypeNameSnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L238-L238">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">Lean.Language.SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotLeaf">Lean.Language.instTypeNameSnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.inst._@.Lean.Language.Basic._hyg.2124">Lean.Language.inst✝</a></span></li></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeSnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L240-L241">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">Lean.Language.ToSnapshotTree</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">Lean.Language.SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotLeaf">Lean.Language.instToSnapshotTreeSnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">Lean.Language.SnapshotLeaf</a>) =&gt; <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">Lean.Language.SnapshotTree.mk</a> <span class="fn"><span class="fn">s</span>.toSnapshot</span> <span class="fn">#[]</span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L244-L248">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Arbitrary snapshot type, used for extensibility.</p><ul class="structure_fields" id="Lean.Language.DynamicSnapshot.mk"><li id="Lean.Language.DynamicSnapshot.val" class="structure_field"><div class="structure_field_info">val : <a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a></div><div class="structure_field_doc"><p>Concrete snapshot value as <code><a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a></code>.</p></div></li><li id="Lean.Language.DynamicSnapshot.tree" class="structure_field"><div class="structure_field_info">tree : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a></div><div class="structure_field_doc"><p>Snapshot tree retrieved from <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded.val">val</a></code> before erasure.</p></div></li></ul><details id="instances-for-list-Lean.Language.DynamicSnapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeDynamicSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L250-L251">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeDynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">Lean.Language.ToSnapshotTree</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeDynamicSnapshot">Lean.Language.instToSnapshotTreeDynamicSnapshot</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a>) =&gt; <span class="fn"><span class="fn">s</span>.tree</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot.ofTyped"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L254-L256">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.ofTyped"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">ofTyped</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <span class="fn">α</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">Lean.Language.ToSnapshotTree</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(val : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a></div></div><p>Creates a <code><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a></code> from a typed snapshot value.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.ofTyped">Lean.Language.DynamicSnapshot.ofTyped</a> <span class="fn">val</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">val</span> := <span class="fn"><a href="../.././Init/Dynamic.html#Dynamic.mk">Dynamic.mk</a> <span class="fn">val</span></span>, <span class="fn">tree</span> := <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.toSnapshotTree">Lean.Language.toSnapshotTree</a> <span class="fn">val</span></span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Language.DynamicSnapshot.ofTyped" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot.toTyped?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L259-L261">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.toTyped?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">toTyped?</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(snap : <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span></div></div><p>Returns the original snapshot value if it is of the given type.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.toTyped?">Lean.Language.DynamicSnapshot.toTyped?</a> <span class="fn">α</span> <span class="fn">snap</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Dynamic.html#Dynamic.get?">Dynamic.get?</a> <span class="fn">α</span> <span class="fn"><span class="fn">snap</span>.val</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.DynamicSnapshot.toTyped?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedDynamicSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L263-L264">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedDynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.forM"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L269-L274">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.forM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">forM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> u_1 → <a href="../.././foundational_types.html">Type</a> u_2</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(s : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a> → <span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#PUnit">PUnit</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#PUnit">PUnit</a></span></div></div><p>Runs a tree of snapshots to conclusion, incrementally performing <code>f</code> on each snapshot in tree
preorder.</p></div></div><div class="decl" id="Lean.Language.printMessageEndPos"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L276-L281">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.printMessageEndPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">printMessageEndPos</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Option for printing end position of each message in addition to start position. Used for testing
message ranges in the test suite.</p></div></div><div class="decl" id="Lean.Language.reportMessages"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L284-L288">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.reportMessages"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">reportMessages</span></a></span><span class="decl_args">
<span class="fn">(msgLog : <a href="../.././Lean/Message.html#Lean.MessageLog">Lean.MessageLog</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(json : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Reports messages on stdout. If <code>json</code> is true, prints messages as JSON (one per line).</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.reportMessages" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.runAndReport"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L295-L296">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.runAndReport"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">runAndReport</span></a></span><span class="decl_args">
<span class="fn">(s : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(json : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Runs a tree of snapshots to conclusion and incrementally report messages on stdout. Messages are
reported in tree preorder.
This function is used by the cmdline driver; see <code>Lean.Server.FileWorker.reportSnapshots</code> for how
the language server reports snapshots asynchronously.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">s</span>.runAndReport</span> <span class="fn">opts</span> <span class="fn">json</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn">s</span>.forM</span> <span class="fn">fun (<span class="fn">x</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a>) =&gt; <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.reportMessages">Lean.Language.reportMessages</a> <span class="fn"><span class="fn"><span class="fn">x</span>.diagnostics</span>.msgLog</span> <span class="fn">opts</span> <span class="fn">json</span></span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.runAndReport" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.getAll"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L299-L300">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.getAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">getAll</span></a></span><span class="decl_args">
<span class="fn">(s : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a></span></div></div><p>Waits on and returns all snapshots in the tree.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">s</span>.getAll</span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn">(<a href="../.././Init/Control/State.html#StateT.run">StateT.run</a> <span class="fn">(<span class="fn"><span class="fn">s</span>.forM</span> <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a>) =&gt; <span class="fn"><a href="../.././Init/Prelude.html#modify">modify</a> <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a></span>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.push</span> <span class="fn">s</span></span></span></span></span>)</span>
      <span class="fn">#[]</span>)</span>.snd</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.getAll" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L303-L303">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingContext</span></a></span><span class="decl_extends">extends</span><span class="decl_parent">
<span class="fn"><a class="break_within" href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext"><span class="name">Lean</span>.<span class="name">Parser</span>.<span class="name">InputContext</span></a></span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Context of an input processing invocation.</p><ul class="structure_fields" id="Lean.Language.ProcessingContext.mk"></ul><details id="instances-for-list-Lean.Language.ProcessingContext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingT"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L306-L306">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingT</span></a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>)</span></span>
<span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a> u_1</div></div><p>Monad transformer holding all relevant data for processing.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <span class="fn">m</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext">Lean.Language.ProcessingContext</a> <span class="fn">m</span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.ProcessingT" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L308-L308">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Monad holding all relevant data for processing.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <a href="../.././Init/System/IO.html#BaseIO">BaseIO</a></span></span></li></ul></details><details id="instances-for-list-Lean.Language.ProcessingM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instMonadLiftProcessingMProcessingTIO"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L310-L311">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instMonadLiftProcessingMProcessingTIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instMonadLiftProcessingMProcessingTIO</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#MonadLift">MonadLift</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <a href="../.././Init/System/IO.html#IO">IO</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.instMonadLiftProcessingMProcessingTIO">Lean.Language.instMonadLiftProcessingMProcessingTIO</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{
    <span class="fn">monadLift</span> := <span class="fn">fun {<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>} (<span class="fn">act</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <span class="fn">α</span></span>) (<span class="fn">ctx</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext">Lean.Language.ProcessingContext</a>) =&gt;
      <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn">act</span> <span class="fn">ctx</span>)</span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.Diagnostics.ofMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L317-L319">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">ofMessageLog</span></a></span><span class="decl_args">
<span class="fn">(msgLog : <a href="../.././Lean/Message.html#Lean.MessageLog">Lean.MessageLog</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Lean.Language.Snapshot.Diagnostics</a></span></div></div><p>Creates snapshot message log from non-interactive message log, also allocating a mutable cell
that can be used by the server to memorize interactive diagnostics derived from the log.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog">Lean.Language.Snapshot.Diagnostics.ofMessageLog</a> <span class="fn">msgLog</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/IO.html#IO.mkRef">IO.mkRef</a> <span class="fn">none</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">{ <span class="fn">msgLog</span> := <span class="fn">msgLog</span>, <span class="fn">interactiveDiagsRef?</span> := <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">__do_lift</span></span> }</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics.ofMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.diagnosticsOfHeaderError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L322-L329">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.diagnosticsOfHeaderError"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">diagnosticsOfHeaderError</span></a></span><span class="decl_args">
<span class="fn">(msg : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Lean.Language.Snapshot.Diagnostics</a></span></div></div><p>Creates diagnostics from a single error message that should span the whole file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.diagnosticsOfHeaderError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.withHeaderExceptions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L334-L337">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.withHeaderExceptions"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withHeaderExceptions</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ex : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a> → <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <span class="fn">α</span></span></div></div><p>Adds unexpected exceptions from header processing to the message log as a last resort; standard
errors should already have been caught earlier.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.withHeaderExceptions" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.mkIncrementalProcessor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Language/Basic.lean#L344-L350">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.mkIncrementalProcessor"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">mkIncrementalProcessor</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{InitSnap : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(process : <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">InitSnap</span></span> → <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <span class="fn">InitSnap</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext">Lean.Parser.InputContext</a> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">InitSnap</span></span>)</span></span></div></div><p>Builds a function for processing a language using incremental snapshots by passing the previous
snapshot to <code>Language.process</code> on subsequent invocations.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.mkIncrementalProcessor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>