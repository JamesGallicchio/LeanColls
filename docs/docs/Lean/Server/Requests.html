<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Server.Requests</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Server.Requests";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Requests</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/DeclarationRange.html">Lean.DeclarationRange</a></li><li><a href="../.././Lean/Data/Json.html">Lean.Data.Json</a></li><li><a href="../.././Lean/Data/Lsp.html">Lean.Data.Lsp</a></li><li><a href="../.././Lean/Elab/Command.html">Lean.Elab.Command</a></li><li><a href="../.././Lean/Server/FileSource.html">Lean.Server.FileSource</a></li><li><a href="../.././Lean/Server/FileWorker/Utils.html">Lean.Server.FileWorker.Utils</a></li><li><a href="../.././Lean/Server/Rpc/Basic.html">Lean.Server.Rpc.Basic</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Server.Requests" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.findInfoTreeAtPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">findInfoTreeAtPos</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.findInfoTreeAtPos.goSeq"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">findInfoTreeAtPos</span>.<span class="name">goSeq</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.instInhabitedRequestError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instInhabitedRequestError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.fileChanged"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">fileChanged</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.methodNotFound"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">methodNotFound</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.invalidParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">invalidParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.internalError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">internalError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.ofException"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">ofException</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.ofIoError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">ofIoError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestError.toLspResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">toLspResponseError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.parseRequestParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">parseRequestParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestT"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestT</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestTask.pure"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestTask</span>.<span class="name">pure</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.instMonadLiftIORequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instMonadLiftIORequestM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.instMonadLiftEIOExceptionRequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instMonadLiftEIOExceptionRequestM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.readDoc"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">readDoc</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.asTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">asTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.mapTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">mapTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.bindTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">bindTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.waitFindSnapAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">waitFindSnapAux</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.withWaitFindSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">withWaitFindSnap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.bindWaitFindSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">bindWaitFindSnap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.withWaitFindSnapAtPos"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">withWaitFindSnapAtPos</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.findCmdParsedSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findCmdParsedSnap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.findCmdParsedSnap.go"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findCmdParsedSnap</span>.<span class="name">go</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.findInfoTreeAtPos"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findInfoTreeAtPos</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.runCommandElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runCommandElabM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.runCoreM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestM.runTermElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runTermElabM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.RequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.requestHandlers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">requestHandlers</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.registerLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">registerLspRequestHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.lookupLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">lookupLspRequestHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.chainLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">chainLspRequestHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.routeLspRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">routeLspRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.handleLspRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">handleLspRequest</span></a></div></nav><main>
<div class="decl" id="Lean.Language.SnapshotTree.findInfoTreeAtPos"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L26-L41">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Language.SnapshotTree.findInfoTreeAtPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">findInfoTreeAtPos</span></a></span><span class="decl_args">
<span class="fn">(tree : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(pos : <a href="../.././Init/Prelude.html#String.Pos">String.Pos</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Lean.Elab.InfoTree</a>)</span></span></div></div><p>Finds the first (in pre-order) snapshot task in <code>tree</code> whose <code>range?</code> contains <code>pos</code> and which
contains an info tree, and then returns that info tree, waiting for any snapshot tasks on the way.
Subtrees that do not contain the position are skipped without forcing their tasks.</p></div></div><div class="decl" id="Lean.Language.SnapshotTree.findInfoTreeAtPos.goSeq"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L30-L41">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Language.SnapshotTree.findInfoTreeAtPos.goSeq"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">findInfoTreeAtPos</span>.<span class="name">goSeq</span></a></span><span class="decl_args">
<span class="fn">(pos : <a href="../.././Init/Prelude.html#String.Pos">String.Pos</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Lean.Language.SnapshotTask</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>)</span></span> → <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Lean.Elab.InfoTree</a>)</span></span></span></div></div></div></div><div class="decl" id="Lean.Server.RequestError"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L47-L50">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.RequestError.mk"><li id="Lean.Server.RequestError.code" class="structure_field"><div class="structure_field_info">code : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode">Lean.JsonRpc.ErrorCode</a></div></li><li id="Lean.Server.RequestError.message" class="structure_field"><div class="structure_field_info">message : <a href="../.././Init/Prelude.html#String">String</a></div></li></ul><details id="instances-for-list-Lean.Server.RequestError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.instInhabitedRequestError"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L50-L50">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.instInhabitedRequestError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instInhabitedRequestError</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.instInhabitedRequestError">Lean.Server.instInhabitedRequestError</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">code</span> := <span class="fn">default</span>, <span class="fn">message</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.fileChanged"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L55-L57">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.fileChanged"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">fileChanged</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.fileChanged">Lean.Server.RequestError.fileChanged</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">code</span> := <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode.contentModified">Lean.JsonRpc.ErrorCode.contentModified</a>, <span class="fn">message</span> := <span class="fn">&quot;File changed.&quot;</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.fileChanged" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.methodNotFound"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L59-L61">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.methodNotFound"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">methodNotFound</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.methodNotFound">Lean.Server.RequestError.methodNotFound</a> <span class="fn">method</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">code</span> := <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode.methodNotFound">Lean.JsonRpc.ErrorCode.methodNotFound</a>,
    <span class="fn">message</span> := <span class="fn"><span class="fn"><span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">&quot;No request handler found for '&quot;</span></span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">method</span></span></span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">&quot;'&quot;</span></span></span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.methodNotFound" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.invalidParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L63-L64">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.invalidParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">invalidParams</span></a></span><span class="decl_args">
<span class="fn">(message : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.invalidParams">Lean.Server.RequestError.invalidParams</a> <span class="fn">message</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">code</span> := <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode.invalidParams">Lean.JsonRpc.ErrorCode.invalidParams</a>, <span class="fn">message</span> := <span class="fn">message</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.invalidParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.internalError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L66-L67">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.internalError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">internalError</span></a></span><span class="decl_args">
<span class="fn">(message : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.internalError">Lean.Server.RequestError.internalError</a> <span class="fn">message</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">code</span> := <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode.internalError">Lean.JsonRpc.ErrorCode.internalError</a>, <span class="fn">message</span> := <span class="fn">message</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.internalError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.ofException"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L69-L70">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.ofException"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">ofException</span></a></span><span class="decl_args">
<span class="fn">(e : <a href="../.././Lean/Exception.html#Lean.Exception">Lean.Exception</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.ofException">Lean.Server.RequestError.ofException</a> <span class="fn">e</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><span class="fn"><span class="fn">e</span>.toMessageData</span>.toString</span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.internalError">Lean.Server.RequestError.internalError</a> <span class="fn">__do_lift</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.ofException" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.ofIoError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L72-L73">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.ofIoError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">ofIoError</span></a></span><span class="decl_args">
<span class="fn">(e : <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.ofIoError">Lean.Server.RequestError.ofIoError</a> <span class="fn">e</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.internalError">Lean.Server.RequestError.internalError</a> <span class="fn">(<a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">e</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.ofIoError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestError.toLspResponseError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L75-L78">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.toLspResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestError</span>.<span class="name">toLspResponseError</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ResponseError">Lean.JsonRpc.ResponseError</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.toLspResponseError">Lean.Server.RequestError.toLspResponseError</a> <span class="fn">id</span> <span class="fn">e</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">id</span> := <span class="fn">id</span>, <span class="fn">code</span> := <span class="fn"><span class="fn">e</span>.code</span>, <span class="fn">message</span> := <span class="fn"><span class="fn">e</span>.message</span>, <span class="fn">data?</span> := <span class="fn">none</span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestError.toLspResponseError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.parseRequestParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L82-L86">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.parseRequestParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">parseRequestParams</span></a></span><span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a> <span class="fn">paramType</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.parseRequestParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L88-L93">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.RequestContext.mk"><li id="Lean.Server.RequestContext.rpcSessions" class="structure_field"><div class="structure_field_info">rpcSessions : <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Init/Prelude.html#UInt64">UInt64</a> <span class="fn">(<a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.RpcSession">Lean.Server.FileWorker.RpcSession</a>)</span> <span class="fn">compare</span></span></div></li><li id="Lean.Server.RequestContext.srcSearchPath" class="structure_field"><div class="structure_field_info">srcSearchPath : <a href="../.././Lean/Util/Path.html#Lean.SearchPath">Lean.SearchPath</a></div></li><li id="Lean.Server.RequestContext.doc" class="structure_field"><div class="structure_field_info">doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a></div></li><li id="Lean.Server.RequestContext.hLog" class="structure_field"><div class="structure_field_info">hLog : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.RequestContext.initParams" class="structure_field"><div class="structure_field_info">initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lean.Lsp.InitializeParams</a></div></li></ul><details id="instances-for-list-Lean.Server.RequestContext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L95-L95">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestTask</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a> u_1)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a> u_1</div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">α</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a> <span class="fn">α</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestT"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L96-L96">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestT"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestT</span></a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>)</span></span>
<span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a> u_1</div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestT">Lean.Server.RequestT</a> <span class="fn">m</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a> <span class="fn">(<a href="../.././Init/Control/Except.html#ExceptT">ExceptT</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a> <span class="fn">m</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestT" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L98-L98">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Workers execute request handlers in this monad.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a> <span class="fn">(<a href="../.././Init/System/IO.html#EIO">EIO</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestTask.pure"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L100-L100">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask.pure"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestTask</span>.<span class="name">pure</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="decl_args">
<span class="fn">(a : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask.pure">Lean.Server.RequestTask.pure</a> <span class="fn">a</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">get</span> := <span class="fn"><a href="../.././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">a</span></span> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestTask.pure" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.instMonadLiftIORequestM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L102-L106">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.instMonadLiftIORequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instMonadLiftIORequestM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#MonadLift">MonadLift</a> <a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.instMonadLiftEIOExceptionRequestM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L108-L112">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.instMonadLiftEIOExceptionRequestM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">instMonadLiftEIOExceptionRequestM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#MonadLift">MonadLift</a> <span class="fn">(<a href="../.././Init/System/IO.html#EIO">EIO</a> <a href="../.././Lean/Exception.html#Lean.Exception">Lean.Exception</a>)</span> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.readDoc"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L118-L120">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.readDoc"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">readDoc</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadReaderOf">MonadReaderOf</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.Server.RequestM.readDoc</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">rc</span> ← <span class="fn"><a href="../.././Init/Prelude.html#readThe">readThe</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">rc</span>.doc</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.readDoc" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.asTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L122-L124">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.asTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">asTask</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">t</span>.asTask</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">rc</span> ← <span class="fn"><a href="../.././Init/Prelude.html#readThe">readThe</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn"><span class="fn">(<a href="../.././Init/Prelude.html#ReaderT.run">ReaderT.run</a> <span class="fn">t</span> <span class="fn">rc</span>)</span>.asTask</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.asTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.mapTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L126-L128">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.mapTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">mapTask</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">β</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.mapTask">Lean.Server.RequestM.mapTask</a> <span class="fn">t</span> <span class="fn">f</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">rc</span> ← <span class="fn"><a href="../.././Init/Prelude.html#readThe">readThe</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href="../.././Init/System/IO.html#EIO.mapTask">EIO.mapTask</a> <span class="fn">(fun (<span class="fn">x</span> : <span class="fn">α</span>) =&gt; <span class="fn"><span class="fn">f</span> <span class="fn">x</span> <span class="fn">rc</span></span>)</span> <span class="fn">t</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.mapTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.bindTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L130-L132">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.bindTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">bindTask</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(t : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.bindTask">Lean.Server.RequestM.bindTask</a> <span class="fn">t</span> <span class="fn">f</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">rc</span> ← <span class="fn"><a href="../.././Init/Prelude.html#readThe">readThe</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestContext">Lean.Server.RequestContext</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href="../.././Init/System/IO.html#EIO.bindTask">EIO.bindTask</a> <span class="fn">t</span> <span class="fn">fun (<span class="fn">x</span> : <span class="fn">α</span>) =&gt; <span class="fn"><span class="fn">f</span> <span class="fn">x</span> <span class="fn">rc</span></span></span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.bindTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.waitFindSnapAux"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L134-L141">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.waitFindSnapAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">waitFindSnapAux</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(notFoundX : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(x : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a>)</span></span> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">notFoundX</span>.waitFindSnapAux</span> <span class="fn">x✝</span> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <span class="fn"><a href="../.././Init/Prelude.html#Except.error">Except.error</a> <span class="fn">e</span></span> =&gt; <span class="fn"><a href="../.././Init/Prelude.html#MonadExcept.throw">throw</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError.ofIoError">Lean.Server.RequestError.ofIoError</a> <span class="fn">e</span>)</span></span>
  | <span class="fn"><a href="../.././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">none</span></span> =&gt; <span class="fn">notFoundX</span>
  | <span class="fn"><a href="../.././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">snap</span>)</span></span> =&gt; <span class="fn"><span class="fn">x✝</span> <span class="fn">snap</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.waitFindSnapAux" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.withWaitFindSnap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L146-L151">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.withWaitFindSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">withWaitFindSnap</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a>)</span></span>
<span class="decl_args">
<span class="fn">(p : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(notFoundX : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">β</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(x : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">β</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></div></div><p>Create a task which waits for the first snapshot matching <code>p</code>, handles various errors,
and if a matching snapshot was found executes <code>x</code> with it. If not found, the task executes
<code>notFoundX</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.withWaitFindSnap">Lean.Server.RequestM.withWaitFindSnap</a> <span class="fn">doc</span> <span class="fn">p</span> <span class="fn">notFoundX</span> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">let <span class="fn">findTask</span> := <span class="fn"><a href="../.././Lean/Server/AsyncList.html#IO.AsyncList.waitFind?">IO.AsyncList.waitFind?</a> <span class="fn">p</span> <span class="fn"><span class="fn">doc</span>.cmdSnaps</span></span>;
  <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.mapTask">Lean.Server.RequestM.mapTask</a> <span class="fn">findTask</span> <span class="fn">(<span class="fn"><span class="fn">notFoundX</span>.waitFindSnapAux</span> <span class="fn">x</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.withWaitFindSnap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.bindWaitFindSnap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L154-L159">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.bindWaitFindSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">bindWaitFindSnap</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a>)</span></span>
<span class="decl_args">
<span class="fn">(p : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(notFoundX : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(x : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">β</span>)</span></span></div></div><p>See <code><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.withWaitFindSnap">withWaitFindSnap</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.bindWaitFindSnap">Lean.Server.RequestM.bindWaitFindSnap</a> <span class="fn">doc</span> <span class="fn">p</span> <span class="fn">notFoundX</span> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">let <span class="fn">findTask</span> := <span class="fn"><a href="../.././Lean/Server/AsyncList.html#IO.AsyncList.waitFind?">IO.AsyncList.waitFind?</a> <span class="fn">p</span> <span class="fn"><span class="fn">doc</span>.cmdSnaps</span></span>;
  <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.bindTask">Lean.Server.RequestM.bindTask</a> <span class="fn">findTask</span> <span class="fn">(<span class="fn"><span class="fn">notFoundX</span>.waitFindSnapAux</span> <span class="fn">x</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.RequestM.bindWaitFindSnap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.withWaitFindSnapAtPos"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L163-L171">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.withWaitFindSnapAtPos"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">withWaitFindSnapAtPos</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(lspPos : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Position">Lean.Lsp.Position</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">α</span>)</span></span></div></div><p>Create a task which waits for the snapshot containing <code>lspPos</code> and executes <code>f</code> with it.
If no such snapshot exists, the request fails with an error.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.withWaitFindSnapAtPos" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.findCmdParsedSnap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L175-L190">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.findCmdParsedSnap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findCmdParsedSnap</span></a></span><span class="decl_args">
<span class="fn">(doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a>)</span></span>
<span class="decl_args">
<span class="fn">(p : <span class="fn"><a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.CommandParsedSnapshot">Lean.Language.Lean.CommandParsedSnapshot</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.CommandParsedSnapshot">Lean.Language.Lean.CommandParsedSnapshot</a>)</span></span></div></div><p>Finds the first <code>CommandParsedSnapshot</code> fulfilling <code>p</code>, asynchronously.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.findCmdParsedSnap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.findCmdParsedSnap.go"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L184-L190">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.findCmdParsedSnap.go"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findCmdParsedSnap</span>.<span class="name">go</span></a></span><span class="decl_args">
<span class="fn">(p : <span class="fn"><a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.CommandParsedSnapshot">Lean.Language.Lean.CommandParsedSnapshot</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(cmdParsed : <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.CommandParsedSnapshot">Lean.Language.Lean.CommandParsedSnapshot</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.CommandParsedSnapshot">Lean.Language.Lean.CommandParsedSnapshot</a>)</span></span></div></div></div></div><div class="decl" id="Lean.Server.RequestM.findInfoTreeAtPos"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L199-L210">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.findInfoTreeAtPos"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">findInfoTreeAtPos</span></a></span><span class="decl_args">
<span class="fn">(doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a>)</span></span>
<span class="decl_args">
<span class="fn">(pos : <a href="../.././Init/Prelude.html#String.Pos">String.Pos</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Lean.Elab.InfoTree</a>)</span></span></div></div><p>Finds the info tree of the first snapshot task containing <code>pos</code>, asynchronously. The info tree may
be from a nested snapshot, such as a single tactic.</p><p>See <code><a href="../.././Lean/Server/Requests.html#Lean.Language.SnapshotTree.findInfoTreeAtPos">SnapshotTree.findInfoTreeAtPos</a></code> for details on how the search is done.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.findInfoTreeAtPos" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.runCommandElabM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L213-L217">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.runCommandElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runCommandElabM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(snap : <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a>)</span></span>
<span class="decl_args">
<span class="fn">(c : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestT">Lean.Server.RequestT</a> <a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.CommandElabM">Lean.Elab.Command.CommandElabM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.runCommandElabM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.runCoreM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L219-L223">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.runCoreM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runCoreM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(snap : <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a>)</span></span>
<span class="decl_args">
<span class="fn">(c : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestT">Lean.Server.RequestT</a> <a href="../.././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.runCoreM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.RequestM.runTermElabM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L226-L230">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestM.runTermElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestM</span>.<span class="name">runTermElabM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(snap : <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a>)</span></span>
<span class="decl_args">
<span class="fn">(c : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestT">Lean.Server.RequestT</a> <a href="../.././Lean/Elab/Term.html#Lean.Elab.Term.TermElabM">Lean.Elab.TermElabM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.RequestM.runTermElabM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="The-global-request-handlers-table">The global request handlers table <a class="hover-link" href="#The-global-request-handlers-table">#</a></h1><p>We maintain a global map of LSP request handlers. This allows user code such as plugins
to register its own handlers, for example to support ITP functionality such as goal state
visualization.</p><p>For details of how to register one, see <code><a href="../.././Lean/Server/Requests.html#Lean.Server.registerLspRequestHandler">registerLspRequestHandler</a></code>.</p></div><div class="decl" id="Lean.Server.RequestHandler"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L244-L246">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.RequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">RequestHandler</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.RequestHandler.mk"><li id="Lean.Server.RequestHandler.fileSource" class="structure_field"><div class="structure_field_info">fileSource : <span class="fn"><a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a> → <span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a></span></span></div></li><li id="Lean.Server.RequestHandler.handle" class="structure_field"><div class="structure_field_info">handle : <span class="fn"><a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span></span></div></li></ul><details id="instances-for-list-Lean.Server.RequestHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.requestHandlers"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L248-L249">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.requestHandlers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">requestHandlers</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href="../.././Init/Prelude.html#String">String</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestHandler">Lean.Server.RequestHandler</a>)</span></span></div></div></div></div><div class="decl" id="Lean.Server.registerLspRequestHandler"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L263-L278">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.registerLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">registerLspRequestHandler</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Server/FileSource.html#Lean.Lsp.FileSource">Lean.Lsp.FileSource</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(respType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">Lean.ToJson</a> <span class="fn">respType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(handler : <span class="fn"><span class="fn">paramType</span> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">respType</span>)</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>NB: This method may only be called in <code>initialize</code> blocks (user or builtin).</p><p>A registration consists of:</p><ul>
<li>a type of JSON-parsable request data <code>paramType</code></li>
<li>a <code>FileSource</code> instance for it so the system knows where to route requests</li>
<li>a type of JSON-serializable response data <code>respType</code></li>
<li>an actual <code>handler</code> which runs in the <code><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">RequestM</a></code> monad and is expected
to produce an asynchronous <code><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">RequestTask</a></code> which does any waiting/computation</li>
</ul><p>A handler task may be cancelled at any time, so it should check the cancellation token when possible
to handle this cooperatively. Any exceptions thrown in a request handler will be reported to the client
as LSP error responses.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.registerLspRequestHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.lookupLspRequestHandler"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L280-L281">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.lookupLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">lookupLspRequestHandler</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestHandler">Lean.Server.RequestHandler</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.lookupLspRequestHandler">Lean.Server.lookupLspRequestHandler</a> <span class="fn">method</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.requestHandlers">Lean.Server.requestHandlers</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(<span class="fn"><span class="fn">__do_lift</span>.find?</span> <span class="fn">method</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.lookupLspRequestHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.chainLspRequestHandler"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L290-L307">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.chainLspRequestHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">chainLspRequestHandler</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(respType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">respType</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">Lean.ToJson</a> <span class="fn">respType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(handler : <span class="fn"><span class="fn">paramType</span> → <span class="fn"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">respType</span></span> → <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <span class="fn">respType</span>)</span></span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>NB: This method may only be called in <code>initialize</code> blocks (user or builtin).</p><p>Register another handler to invoke after the last one registered for a method.
At least one handler for the method must have already been registered to perform
chaining.</p><p>For more details on the registration of a handler, see <code><a href="../.././Lean/Server/Requests.html#Lean.Server.registerLspRequestHandler">registerLspRequestHandler</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.chainLspRequestHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.routeLspRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L309-L312">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.routeLspRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">routeLspRequest</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">Lean.Server.RequestError</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.routeLspRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.handleLspRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Server/Requests.lean#L314-L319">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Requests.html#Lean.Server.handleLspRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">handleLspRequest</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">Lean.Server.RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">Lean.Server.RequestTask</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.handleLspRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>