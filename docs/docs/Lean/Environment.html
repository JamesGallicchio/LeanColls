<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="icon" href=".././favicon.svg"></link><link rel="mask-icon" href=".././favicon.svg" color="#000000"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Environment</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.Environment";</script><script type="module" src=".././jump-src.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././expand-nav.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Environment</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Lean/Declaration.html">Lean.Declaration</a></li><li><a href=".././Lean/ImportingFlag.html">Lean.ImportingFlag</a></li><li><a href=".././Lean/LocalContext.html">Lean.LocalContext</a></li><li><a href=".././Init/Control/StateRef.html">Init.Control.StateRef</a></li><li><a href=".././Init/Data/Stream.html">Init.Data.Stream</a></li><li><a href=".././Lean/Data/HashMap.html">Lean.Data.HashMap</a></li><li><a href=".././Lean/Data/SMap.html">Lean.Data.SMap</a></li><li><a href=".././Lean/Util/FindExpr.html">Lean.Util.FindExpr</a></li><li><a href=".././Lean/Util/InstantiateLevelParams.html">Lean.Util.InstantiateLevelParams</a></li><li><a href=".././Lean/Util/Path.html">Lean.Util.Path</a></li><li><a href=".././Lean/Util/Profile.html">Lean.Util.Profile</a></li><li><a href=".././Init/Data/Array/BinSearch.html">Init.Data.Array.BinSearch</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Environment" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionStateSpec"><span class="name">Lean</span>.<span class="name">EnvExtensionStateSpec</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionState"><span class="name">Lean</span>.<span class="name">EnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx"><span class="name">Lean</span>.<span class="name">ModuleIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx.toNat"><span class="name">Lean</span>.<span class="name">ModuleIdx</span>.<span class="name">toNat</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleIdx"><span class="name">Lean</span>.<span class="name">instInhabitedModuleIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstMap"><span class="name">Lean</span>.<span class="name">ConstMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Import"><span class="name">Lean</span>.<span class="name">Import</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instReprImport"><span class="name">Lean</span>.<span class="name">instReprImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedImport"><span class="name">Lean</span>.<span class="name">instInhabitedImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instCoeNameImport"><span class="name">Lean</span>.<span class="name">instCoeNameImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instToStringImport"><span class="name">Lean</span>.<span class="name">instToStringImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion"><span class="name">Lean</span>.<span class="name">CompactedRegion</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.isMemoryMapped"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">isMemoryMapped</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.free"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">free</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntrySpec"><span class="name">Lean</span>.<span class="name">EnvExtensionEntrySpec</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntry"><span class="name">Lean</span>.<span class="name">EnvExtensionEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvExtensionEntry"><span class="name">Lean</span>.<span class="name">instNonemptyEnvExtensionEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleData"><span class="name">Lean</span>.<span class="name">ModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleData"><span class="name">Lean</span>.<span class="name">instInhabitedModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvironmentHeader"><span class="name">Lean</span>.<span class="name">EnvironmentHeader</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvironmentHeader"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironmentHeader</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment"><span class="name">Lean</span>.<span class="name">Environment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addExtraName"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addExtraName</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.find?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.contains"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">contains</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.imports"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">imports</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.allImportedModuleNames"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">allImportedModuleNames</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.setMainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setMainModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.mainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">mainModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdxFor?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdxFor?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isConstructor"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isConstructor</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isSafeDefinition"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isSafeDefinition</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdx?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdx?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.KernelException"><span class="name">Lean</span>.<span class="name">KernelException</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addDeclWithoutChecking"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclWithoutChecking</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateTypeLevelParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateValueLevelParams!"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateValueLevelParams!</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterface"><span class="name">Lean</span>.<span class="name">EnvExtensionInterface</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtensionInterface"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionInterface</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.Ext"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">Ext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">instInhabitedExt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">ensureExtensionsArraySize</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">ensureExtensionsArraySize</span>.<span class="name">loop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.setState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.getState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.registerExt"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">registerExt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">mkInitialExtStates</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.imp"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">imp</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceImp"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceImp</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension"><span class="name">Lean</span>.<span class="name">EnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.instInhabited"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">instInhabited</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.setState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.getState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerEnvExtension"><span class="name">Lean</span>.<span class="name">registerEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkEmptyEnvironment"><span class="name">Lean</span>.<span class="name">mkEmptyEnvironment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM.Context"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">Context</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM"><span class="name">Lean</span>.<span class="name">ImportM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getModuleEntries"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getModuleEntries</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.addEntry"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">addEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.persistentEnvExtensionsRef"><span class="name">Lean</span>.<span class="name">persistentEnvExtensionsRef</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionDescr</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtensionUnsafe"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtensionUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkStateFromImportedEntries"><span class="name">Lean</span>.<span class="name">mkStateFromImportedEntries</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtensionDescr</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerSimplePersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerSimplePersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.instInhabited"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">instInhabited</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.getEntries"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">getEntries</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkTagDeclarationExtension"><span class="name">Lean</span>.<span class="name">mkTagDeclarationExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.instInhabited"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">instInhabited</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.tag"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">tag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.isTagged"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">isTagged</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkMapDeclarationExtension"><span class="name">Lean</span>.<span class="name">mkMapDeclarationExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.instInhabited"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">instInhabited</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.insert"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">insert</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.find?"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">find?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.contains"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">contains</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.saveModuleData"><span class="name">Lean</span>.<span class="name">saveModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.readModuleData"><span class="name">Lean</span>.<span class="name">readModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.freeRegions"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">freeRegions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkModuleData"><span class="name">Lean</span>.<span class="name">mkModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.writeModule"><span class="name">Lean</span>.<span class="name">writeModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkExtNameMap"><span class="name">Lean</span>.<span class="name">mkExtNameMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.updateEnvAttributes"><span class="name">Lean</span>.<span class="name">updateEnvAttributes</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.getNumBuiltinAttributes"><span class="name">Lean</span>.<span class="name">getNumBuiltinAttributes</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportState"><span class="name">Lean</span>.<span class="name">ImportState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.throwAlreadyImported"><span class="name">Lean</span>.<span class="name">throwAlreadyImported</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportStateM"><span class="name">Lean</span>.<span class="name">ImportStateM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportStateM.run"><span class="name">Lean</span>.<span class="name">ImportStateM</span>.<span class="name">run</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.importModulesCore"><span class="name">Lean</span>.<span class="name">importModulesCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.finalizeImport"><span class="name">Lean</span>.<span class="name">finalizeImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.importModules"><span class="name">Lean</span>.<span class="name">importModules</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withImportModules"><span class="name">Lean</span>.<span class="name">withImportModules</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.namespacesExt"><span class="name">Lean</span>.<span class="name">namespacesExt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Diagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instInhabitedDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.diagExt"><span class="name">Lean</span>.<span class="name">diagExt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Diagnostics.isEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span>.<span class="name">isEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">enableDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDiagnosticsEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">resetDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Diagnostics.recordUnfold"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span>.<span class="name">recordUnfold</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">getDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">setDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.registerNamespace"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">registerNamespace</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isNamespace"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isNamespace</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getNamespaceSet"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getNamespaceSet</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.displayStats"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">displayStats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConstCheck"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConstCheck</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.hasUnsafe"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">hasUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEq"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEq</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEqGuarded"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEqGuarded</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.whnf"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">whnf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MonadEnv"><span class="name">Lean</span>.<span class="name">MonadEnv</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadEnvOfMonadLift"><span class="name">Lean</span>.<span class="name">instMonadEnvOfMonadLift</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkDefinitionValInferrringUnsafe"><span class="name">Lean</span>.<span class="name">mkDefinitionValInferrringUnsafe</span></a></div></nav><main>
<div class="decl" id="Lean.EnvExtensionStateSpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L22-L22">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec"><span class="name">Lean</span>.<span class="name">EnvExtensionStateSpec</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>) × <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span></span></div></div><p>Opaque environment extension state.</p></div></div><div class="decl" id="Lean.EnvExtensionState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L23-L23">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionState"><span class="name">Lean</span>.<span class="name">EnvExtensionState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.fst</span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtensionState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L24-L24">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState">Lean.instInhabitedEnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.snd</span></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleIdx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L26-L27">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx"><span class="name">Lean</span>.<span class="name">ModuleIdx</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></li></ul></details><details id="instances-for-list-Lean.ModuleIdx" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ModuleIdx.toNat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L29-L29">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx.toNat"><span class="name">Lean</span>.<span class="name">ModuleIdx</span>.<span class="name">toNat</span></a></span><span class="decl_args">
<span class="fn">(midx : <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">midx</span>.toNat</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">midx</span></span></li></ul></details><details id="instances-for-list-Lean.ModuleIdx.toNat" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleIdx"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L31-L31">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx"><span class="name">Lean</span>.<span class="name">instInhabitedModuleIdx</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx">Lean.instInhabitedModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">0</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.ConstMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L33-L33">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstMap"><span class="name">Lean</span>.<span class="name">ConstMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap">Lean.SMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></span></li></ul></details><details id="instances-for-list-Lean.ConstMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Import"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L35-L38">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Import"><span class="name">Lean</span>.<span class="name">Import</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Import.mk"><li id="Lean.Import.module" class="structure_field"><div class="structure_field_info">module : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div></li><li id="Lean.Import.runtimeOnly" class="structure_field"><div class="structure_field_info">runtimeOnly : <a href=".././Init/Prelude.html#Bool">Bool</a></div></li></ul><details id="instances-for-list-Lean.Import" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instReprImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instReprImport"><span class="name">Lean</span>.<span class="name">instReprImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/Repr.html#Repr">Repr</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instReprImport">Lean.instReprImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">reprPrec</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.reprImport._@.Lean.Environment._hyg.84">Lean.reprImport✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedImport"><span class="name">Lean</span>.<span class="name">instInhabitedImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedImport">Lean.instInhabitedImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">module</span> := <span class="fn">default</span>, <span class="fn">runtimeOnly</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instCoeNameImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L40-L40">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instCoeNameImport"><span class="name">Lean</span>.<span class="name">instCoeNameImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Coe.html#Coe">Coe</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instCoeNameImport">Lean.instCoeNameImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">coe</span> := <span class="fn">fun (<span class="fn">x</span> : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>) =&gt; <span class="fn">{ <span class="fn">module</span> := <span class="fn">x</span>, <span class="fn">runtimeOnly</span> := <a href=".././Init/Prelude.html#Bool.false">false</a> }</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instToStringImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L42-L42">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instToStringImport"><span class="name">Lean</span>.<span class="name">instToStringImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instToStringImport">Lean.instToStringImport</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">toString</span> := <span class="fn">fun (<span class="fn">imp</span> : <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a>) =&gt; <span class="fn"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn"><span class="fn">imp</span>.module</span></span> <a href=".././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn">if <span class="fn"><span class="fn"><span class="fn">imp</span>.runtimeOnly</span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn">&quot; (runtime)&quot;</span> else <span class="fn">&quot;&quot;</span></span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.CompactedRegion"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L48-L48">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion"><span class="name">Lean</span>.<span class="name">CompactedRegion</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>A compacted region holds multiple Lean objects in a contiguous memory region, which can be read/written to/from disk.
Objects inside the region do not have reference counters and cannot be freed individually. The contents of .olean
files are compacted regions.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#USize">USize</a></span></li></ul></details><details id="instances-for-list-Lean.CompactedRegion" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.CompactedRegion.isMemoryMapped"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L51-L51">source</a></div><div class="attributes">@[extern  lean_compacted_region_is_memory_mapped]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.isMemoryMapped"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">isMemoryMapped</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.CompactedRegion.free"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L55-L55">source</a></div><div class="attributes">@[extern  lean_compacted_region_free]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.free"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">free</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></div><p>Free a compacted region and its contents. No live references to the contents may exist at the time of invocation.</p></div></div><div class="decl" id="Lean.EnvExtensionEntrySpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L58-L58">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec"><span class="name">Lean</span>.<span class="name">EnvExtensionEntrySpec</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#NonemptyType">NonemptyType</a></div></div><p>Opaque persistent environment extension entry.</p></div></div><div class="decl" id="Lean.EnvExtensionEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L59-L59">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntry"><span class="name">Lean</span>.<span class="name">EnvExtensionEntry</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec">Lean.EnvExtensionEntrySpec</a>.type</span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtensionEntry" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvExtensionEntry"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L60-L60">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry"><span class="name">Lean</span>.<span class="name">instNonemptyEnvExtensionEntry</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry">Lean.instNonemptyEnvExtensionEntry</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">⋯</span></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L64-L81">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleData"><span class="name">Lean</span>.<span class="name">ModuleData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Content of a .olean file.
We use <code>compact.cpp</code> to generate the image of this object in disk.</p><ul class="structure_fields" id="Lean.ModuleData.mk"><li id="Lean.ModuleData.imports" class="structure_field"><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></li><li id="Lean.ModuleData.constNames" class="structure_field"><div class="structure_field_info">constNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span></div><div class="structure_field_doc"><p><code><a href=".././Lean/Environment.html#Lean.ModuleData.constNames">constNames</a></code> contains all constant names in <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>.
This information is redundant. It is equal to <code>constants.map fun c =&gt; c.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.name">name</a></code>,
but it improves the performance of <code><a href=".././Lean/Environment.html#Lean.importModules">importModules</a></code>. <code>perf</code> reports that 12% of the
runtime was being spent on <code>ConstantInfo.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.name">name</a></code> when importing a file containing only <code>import <a href=".././Lean.html">Lean</a></code></p></div></li><li id="Lean.ModuleData.constants" class="structure_field"><div class="structure_field_info">constants : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></div></li><li id="Lean.ModuleData.extraConstNames" class="structure_field"><div class="structure_field_info">extraConstNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span></div><div class="structure_field_doc"><p>Extra entries for the <code><a href=".././Lean/Environment.html#Lean.Environment.const2ModIdx">const2ModIdx</a></code> map in the <code><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></code> object.
The code generator creates auxiliary declarations that are not in the
mapping <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>, but we want to know in which module they were generated.</p></div></li><li id="Lean.ModuleData.entries" class="structure_field"><div class="structure_field_info">entries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></span>)</span></span></div></li></ul><details id="instances-for-list-Lean.ModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleData"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L81-L81">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleData"><span class="name">Lean</span>.<span class="name">instInhabitedModuleData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedModuleData">Lean.instInhabitedModuleData</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{
    <span class="fn">default</span> :=
      <span class="fn">{ <span class="fn">imports</span> := <span class="fn">default</span>, <span class="fn">constNames</span> := <span class="fn">default</span>, <span class="fn">constants</span> := <span class="fn">default</span>, <span class="fn">extraConstNames</span> := <span class="fn">default</span>,
        <span class="fn">entries</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvironmentHeader"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L84-L107">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvironmentHeader"><span class="name">Lean</span>.<span class="name">EnvironmentHeader</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Environment fields that are not used often.</p><ul class="structure_fields" id="Lean.EnvironmentHeader.mk"><li id="Lean.EnvironmentHeader.trustLevel" class="structure_field"><div class="structure_field_info">trustLevel : <a href=".././Init/Prelude.html#UInt32">UInt32</a></div><div class="structure_field_doc"><p>The trust level used by the kernel. For example,
the kernel assumes imported constants are type correct when the trust level is greater than zero.</p></div></li><li id="Lean.EnvironmentHeader.quotInit" class="structure_field"><div class="structure_field_info">quotInit : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p><code><a href=".././Lean/Environment.html#Lean.EnvironmentHeader.quotInit">quotInit</a> = true</code> if the command <code>init_quot</code> has already been executed for the environment, and
<code><a href=".././Init/Prelude.html#Quot">Quot</a></code> declarations have been added to the environment.</p></div></li><li id="Lean.EnvironmentHeader.mainModule" class="structure_field"><div class="structure_field_info">mainModule : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div><div class="structure_field_doc"><p>Name of the module being compiled.</p></div></li><li id="Lean.EnvironmentHeader.imports" class="structure_field"><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div><div class="structure_field_doc"><p>Direct imports</p></div></li><li id="Lean.EnvironmentHeader.regions" class="structure_field"><div class="structure_field_info">regions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span></div><div class="structure_field_doc"><p>Compacted regions for all imported modules. Objects in compacted memory regions do no require any memory management.</p></div></li><li id="Lean.EnvironmentHeader.moduleNames" class="structure_field"><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span></div><div class="structure_field_doc"><p>Name of all imported modules (directly and indirectly).</p></div></li><li id="Lean.EnvironmentHeader.moduleData" class="structure_field"><div class="structure_field_info">moduleData : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div><div class="structure_field_doc"><p>Module data for all imported modules.</p></div></li></ul><details id="instances-for-list-Lean.EnvironmentHeader" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvironmentHeader"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L107-L107">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvironmentHeader"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironmentHeader</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instNonemptyEnvironmentHeader">Lean.instNonemptyEnvironmentHeader</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">⋯</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L123-L155">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment"><span class="name">Lean</span>.<span class="name">Environment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>An environment stores declarations provided by the user. The kernel
currently supports different kinds of declarations such as definitions, theorems,
and inductive families. Each has a unique identifier (i.e., <code>Name</code>), and can be
parameterized by a sequence of universe parameters.
A constant in Lean is just a reference to a <code>ConstantInfo</code> object. The main task of
the kernel is to type check these declarations and refuse type incorrect ones. The
kernel does not allow declarations containing metavariables and/or free variables
to be added to an environment. Environments are never destructively updated.</p><p>The environment also contains a collection of extensions. For example, the <code>simp</code> theorems
declared by users are stored in an environment extension. Users can declare new extensions
using meta-programming.</p><ul class="structure_fields" id="_private.Lean.Environment.0.Lean.Environment.mk"><li id="Lean.Environment.const2ModIdx" class="structure_field"><div class="structure_field_info">const2ModIdx : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div><div class="structure_field_doc"><p>Mapping from constant name to module (index) where constant has been declared.
Recall that a Lean file has a header where previously compiled modules can be imported.
Each imported module has a unique <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code>.
Many extensions use the <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code> to efficiently retrieve information stored in imported modules.</p><p>Remark: this mapping also contains auxiliary constants, created by the code generator, that are <strong>not</strong> in
the field <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>. These auxiliary constants are invisible to the Lean kernel and elaborator.
Only the code generator uses them.</p></div></li><li id="Lean.Environment.constants" class="structure_field"><div class="structure_field_info">constants : <a href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a></div><div class="structure_field_doc"><p>Mapping from constant name to <code>ConstantInfo</code>. It contains all constants (definitions, theorems, axioms, etc)
that have been already type checked by the kernel.</p></div></li><li id="Lean.Environment.extensions" class="structure_field"><div class="structure_field_info">extensions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div><div class="structure_field_doc"><p>Environment extensions. It also includes user-defined extensions.</p></div></li><li id="Lean.Environment.extraConstNames" class="structure_field"><div class="structure_field_info">extraConstNames : <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></div><div class="structure_field_doc"><p>Constant names to be saved in the field <code><a href=".././Lean/Environment.html#Lean.ModuleData.extraConstNames">extraConstNames</a></code> at <code><a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></code>.
It contains auxiliary declaration names created by the code generator which are not in <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>.
When importing modules, we want to insert them at <code><a href=".././Lean/Environment.html#Lean.Environment.const2ModIdx">const2ModIdx</a></code>.</p></div></li><li id="Lean.Environment.header" class="structure_field"><div class="structure_field_info">header : <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></div><div class="structure_field_doc"><p>The header contains additional information that is not updated often.</p></div></li></ul><details id="instances-for-list-Lean.Environment" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvironment"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L155-L155">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instNonemptyEnvironment">Lean.instNonemptyEnvironment</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">⋯</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.addExtraName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L167-L171">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addExtraName"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addExtraName</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(name : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Save an extra constant name that is used to populate <code><a href=".././Lean/Environment.html#Lean.Environment.const2ModIdx">const2ModIdx</a></code> when we import
.olean files. We use this feature to save in which module an auxiliary declaration
created by the code generator has been created.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.addExtraName" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L174-L176">source</a></div><div class="attributes">@[export lean_environment_find]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.find?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.find?</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.find?'">Lean.SMap.find?'</a> <span class="fn"><span class="fn">env</span>.constants</span> <span class="fn">n</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.find?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.contains"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L178-L179">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.contains"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">contains</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.contains</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.contains">Lean.SMap.contains</a> <span class="fn"><span class="fn">env</span>.constants</span> <span class="fn">n</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.contains" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.imports"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L181-L182">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.imports"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">imports</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.imports</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.imports</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.imports" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.allImportedModuleNames"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L184-L185">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.allImportedModuleNames"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">allImportedModuleNames</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.allImportedModuleNames</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.moduleNames</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.allImportedModuleNames" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.setMainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L188-L189">source</a></div><div class="attributes">@[export lean_environment_set_main_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.setMainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setMainModule</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.setMainModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.mainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L192-L193">source</a></div><div class="attributes">@[export lean_environment_main_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.mainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">mainModule</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.mainModule</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.mainModule</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.mainModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdxFor?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L207-L208">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdxFor?</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.getModuleIdxFor?</span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.const2ModIdx</span>.find?</span> <span class="fn">declName</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.getModuleIdxFor?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isConstructor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L210-L213">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isConstructor"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isConstructor</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.isConstructor</span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><span class="fn"><span class="fn">env</span>.find?</span> <span class="fn">declName</span></span> with
  | <span class="fn"><a href=".././Init/Prelude.html#Option.some">some</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.ctorInfo">Lean.ConstantInfo.ctorInfo</a> <span class="fn">val</span>)</span></span> =&gt; <a href=".././Init/Prelude.html#Bool.true">true</a>
  | <span class="fn">x</span> =&gt; <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.isConstructor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isSafeDefinition"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L215-L218">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isSafeDefinition"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isSafeDefinition</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.isSafeDefinition" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdx?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L220-L221">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdx?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdx?</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(moduleName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.getModuleIdx?</span> <span class="fn">moduleName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.moduleNames</span>.findIdx?</span> <span class="fn">fun (<span class="fn">x</span> : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>) =&gt; <span class="fn"><span class="fn">x</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn">moduleName</span></span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.getModuleIdx?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.KernelException"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L226-L243">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.KernelException"><span class="name">Lean</span>.<span class="name">KernelException</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Exceptions that can be raised by the Kernel when type checking new declarations.</p><ul class="constructors"><li class="constructor" id="Lean.KernelException.unknownConstant">unknownConstant: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></li><li class="constructor" id="Lean.KernelException.alreadyDeclared">alreadyDeclared: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></li><li class="constructor" id="Lean.KernelException.declTypeMismatch">declTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/Declaration.html#Lean.Declaration">Lean.Declaration</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.declHasMVars">declHasMVars: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.declHasFVars">declHasFVars: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.funExpected">funExpected: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.typeExpected">typeExpected: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.letTypeMismatch">letTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></span></li><li class="constructor" id="Lean.KernelException.exprTypeMismatch">exprTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.appTypeMismatch">appTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.invalidProj">invalidProj: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.thmTypeIsNotProp">thmTypeIsNotProp: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.other">other: <span class="fn"><a href=".././Init/Prelude.html#String">String</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></li><li class="constructor" id="Lean.KernelException.deterministicTimeout">deterministicTimeout: <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></li><li class="constructor" id="Lean.KernelException.excessiveMemory">excessiveMemory: <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></li><li class="constructor" id="Lean.KernelException.deepRecursion">deepRecursion: <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></li><li class="constructor" id="Lean.KernelException.interrupted">interrupted: <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></li></ul><details id="instances-for-list-Lean.KernelException" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.addDeclCore"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L251-L252">source</a></div><div class="attributes">@[extern  lean_add_decl]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(maxHeartbeats : <a href=".././Init/Prelude.html#USize">USize</a>)</span></span>
<span class="decl_args">
<span class="fn">(decl : <a href=".././Lean/Declaration.html#Lean.Declaration">Lean.Declaration</a>)</span></span>
<span class="decl_args">
<span class="fn">(cancelTk? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><p>Type check given declaration and add it to the environment</p></div></div><div class="decl" id="Lean.Environment.addDeclWithoutChecking"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L261-L261">source</a></div><div class="attributes">@[extern  lean_add_decl_without_checking]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addDeclWithoutChecking"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclWithoutChecking</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(decl : <a href=".././Lean/Declaration.html#Lean.Declaration">Lean.Declaration</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><p>Add declaration to kernel without type checking it.
<strong>WARNING</strong> This function is meant for temporarily working around kernel performance issues.
It compromises soundness because, for example, a buggy tactic may produce an invalid proof,
and the kernel will not catch it if the new option is set to true.</p></div></div><div class="decl" id="Lean.ConstantInfo.instantiateTypeLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L267-L268">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateTypeLevelParams</span></a></span><span class="decl_args">
<span class="fn">(c : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(ls : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.instantiateTypeLevelParams</span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.type</span>.instantiateLevelParams</span> <span class="fn"><span class="fn">c</span>.levelParams</span> <span class="fn">ls</span></span></span></li></ul></details><details id="instances-for-list-Lean.ConstantInfo.instantiateTypeLevelParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ConstantInfo.instantiateValueLevelParams!"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L270-L271">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateValueLevelParams!"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateValueLevelParams!</span></a></span><span class="decl_args">
<span class="fn">(c : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(ls : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.instantiateValueLevelParams!</span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.value!</span>.instantiateLevelParams</span> <span class="fn"><span class="fn">c</span>.levelParams</span> <span class="fn">ls</span></span></span></li></ul></details><details id="instances-for-list-Lean.ConstantInfo.instantiateValueLevelParams!" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterface"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L276-L284">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterface"><span class="name">Lean</span>.<span class="name">EnvExtensionInterface</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a> 1</div></div><p>Interface for managing environment extensions.</p><ul class="structure_fields" id="Lean.EnvExtensionInterface.mk"><li id="Lean.EnvExtensionInterface.ext" class="structure_field"><div class="structure_field_info">ext : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span></div></li><li id="Lean.EnvExtensionInterface.inhabitedExt" class="structure_field"><div class="structure_field_info">inhabitedExt : <span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<span class="fn"><span class="fn">self</span>.ext</span> <span class="fn">σ</span>)</span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.registerExt" class="structure_field"><div class="structure_field_info">registerExt : <span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<span class="fn"><span class="fn">self</span>.ext</span> <span class="fn">σ</span>)</span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.setState" class="structure_field"><div class="structure_field_info">setState : <span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><span class="fn"><span class="fn">self</span>.ext</span> <span class="fn">σ</span></span> → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span> → <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.modifyState" class="structure_field"><div class="structure_field_info">modifyState : <span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><span class="fn"><span class="fn">self</span>.ext</span> <span class="fn">σ</span></span> → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span> → <span class="fn"><span class="fn">(<span class="fn">σ</span> → <span class="fn">σ</span>)</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.getState" class="structure_field"><div class="structure_field_info">getState : <span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn">[<span class="fn">inst</span> : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>] → <span class="fn"><span class="fn"><span class="fn"><span class="fn">self</span>.ext</span> <span class="fn">σ</span></span> → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span> → <span class="fn">σ</span></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.mkInitialExtStates" class="structure_field"><div class="structure_field_info">mkInitialExtStates : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span></span></div></li><li id="Lean.EnvExtensionInterface.ensureExtensionsSize" class="structure_field"><div class="structure_field_info">ensureExtensionsSize : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span></span></span></div></li></ul><details id="instances-for-list-Lean.EnvExtensionInterface" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtensionInterface"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L286-L296">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionInterface"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionInterface</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Unsafe-implementation-of-EnvExtensionInterface">Unsafe implementation of <code><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">EnvExtensionInterface</a></code> <a class="hover-link" href="#Unsafe-implementation-of-EnvExtensionInterface">#</a></h1></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.Ext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L301-L304">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">Ext</span></a></span><span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.EnvExtensionInterfaceUnsafe.Ext.mk"><li id="Lean.EnvExtensionInterfaceUnsafe.Ext.idx" class="structure_field"><div class="structure_field_info">idx : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.EnvExtensionInterfaceUnsafe.Ext.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li></ul><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.Ext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L304-L304">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">instInhabitedExt</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">{<span class="fn">a</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">a</span>)</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">idx</span> := <span class="fn">default</span>, <span class="fn">mkInitial</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L315-L325">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">ensureExtensionsArraySize</span></a></span><span class="decl_args">
<span class="fn">(exts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span></span></div></div><p>User-defined environment extensions are declared using the <code>initialize</code> command.
This command is just syntax sugar for the <code>init</code> attribute.
When we <code>import</code> lean modules, the vector stored at <code>envExtensionsRef</code> may increase in size because of
user-defined environment extensions. When this happens, we must adjust the size of the <code>env.<a href=".././Lean/Environment.html#Lean.Environment.extensions">extensions</a></code>.
This method is invoked when processing <code>import</code>s.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize</a> <span class="fn">exts</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop</a> <span class="fn"><span class="fn">exts</span>.size</span> <span class="fn">exts</span></span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L318-L325">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">ensureExtensionsArraySize</span>.<span class="name">loop</span></a></span><span class="decl_args">
<span class="fn">(i : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(exts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span></span></div></div></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L329-L334">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.setState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(exts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L336-L344">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(exts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L346-L351">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.getState"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(exts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.getState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.registerExt"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L353-L363">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.registerExt"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">registerExt</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.registerExt" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L365-L367">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">mkInitialExtStates</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.imp"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L369-L378">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.imp"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceUnsafe</span>.<span class="name">imp</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.imp" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceImp"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L383-L383">source</a></div><div class="attributes">@[implemented_by Lean.EnvExtensionInterfaceUnsafe.imp]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp"><span class="name">Lean</span>.<span class="name">EnvExtensionInterfaceImp</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></div></div></div></div><div class="decl" id="Lean.EnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L385-L385">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension"><span class="name">Lean</span>.<span class="name">EnvExtension</span></a></span><span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a>.ext</span> <span class="fn">σ</span></span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.instInhabited"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L392-L392">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.instInhabited"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">instInhabited</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[s : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.EnvExtension.instInhabited</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a>.inhabitedExt</span> <span class="fn">s</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L394-L395">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.setState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtension.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L397-L398">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtension.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L400-L401">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.getState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.getState</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a>.getState</span> <span class="fn">ext</span> <span class="fn"><span class="fn">env</span>.extensions</span></span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtension.getState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L412-L412">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerEnvExtension"><span class="name">Lean</span>.<span class="name">registerEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span>)</span></span></div></div><p>Environment extensions can only be registered during initialization.
Reasons:
1- Our implementation assumes the number of extensions does not change after an environment object is created.
2- We do not use any synchronization primitive to access <code>envExtensionsRef</code>.</p><p>Note that by default, extension state is <em>not</em> stored in .olean files and will not propagate across <code>import</code>s.
For that, you need to register a persistent environment extension.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.registerEnvExtension">Lean.registerEnvExtension</a> <span class="fn">mkInitial</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a>.registerExt</span> <span class="fn">mkInitial</span></span></span></li></ul></details><details id="instances-for-list-Lean.registerEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkEmptyEnvironment"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L416-L426">source</a></div><div class="attributes">@[export lean_mk_empty_environment]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkEmptyEnvironment"><span class="name">Lean</span>.<span class="name">mkEmptyEnvironment</span></a></span><span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkEmptyEnvironment" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtensionState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L428-L430">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionState</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionState.mk"><li id="Lean.PersistentEnvExtensionState.importedEntries" class="structure_field"><div class="structure_field_info">importedEntries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span></div></li><li id="Lean.PersistentEnvExtensionState.state" class="structure_field"><div class="structure_field_info">state : <span class="fn">σ</span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtensionState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportM.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L432-L434">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM.Context"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">Context</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.ImportM.Context.mk"><li id="Lean.ImportM.Context.env" class="structure_field"><div class="structure_field_info">env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></li><li id="Lean.ImportM.Context.opts" class="structure_field"><div class="structure_field_info">opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a></div></li></ul><details id="instances-for-list-Lean.ImportM.Context" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L436-L436">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM"><span class="name">Lean</span>.<span class="name">ImportM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context">Lean.ImportM.Context</a> <a href=".././Init/System/IO.html#IO">IO</a></span></span></li></ul></details><details id="instances-for-list-Lean.ImportM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L483-L489">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(β : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>An environment extension with support for storing/retrieving entries from a .olean file.</p><ul>
<li>α is the type of the entries that are stored in .olean files.</li>
<li>β is the type of values used to update the state.</li>
<li>σ is the actual state.</li>
</ul><p>For most extensions, α and β coincide. <code>α</code> and ‵β` do not coincide for extensions where the data
used to update the state contains elements which cannot be stored in files (for example, closures).</p><p>During elaboration of a module, state of type <code>σ</code> can be both read and written. When elaboration is
complete, the state of type <code>σ</code> is converted to serialized state of type <code><a href=".././Init/Prelude.html#Array">Array</a> α</code> by
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>. To read the current module's state, use <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">PersistentEnvExtension.getState</a></code>. To
modify it, use <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">PersistentEnvExtension.addEntry</a></code>, with an <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntryFn">addEntryFn</a></code> that performs the appropriate
modification.</p><p>When a module is loaded, the values saved by all of its dependencies for this
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> are are available as an <code><a href=".././Init/Prelude.html#Array">Array</a> (Array α)</code> via the environment extension,
with one array per transitively imported module. The state of type <code>σ</code> used in the current module
can be initialized from these imports by specifying a suitable <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addImportedFn">addImportedFn</a></code>. The <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addImportedFn">addImportedFn</a></code>
runs at the beginning of elaboration for every module, so it's usually better for performance to
query the array of imported modules directly, because only a fraction of imported entries is usually
queried during elaboration of a module.</p><p>The most typical pattern for using <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> is to set <code>σ</code> to a datatype such as
<code>NameMap</code> that efficiently tracks data for the current module. Then, in <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>, this type
is converted to an array of pairs, sorted by the key. Given <code><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.ext">ext</a> : <a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> α β σ</code> and
<code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></code>, the complete array of imported entries sorted by module index can be obtained
using <code>(ext.toEnvExtension.<a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.getState">getState</a> env).<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.importedEntries">importedEntries</a></code>. To query the extension for some constant
name <code>n</code>, first use <code>env.<a href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">getModuleIdxFor?</a> n</code>. If it returns <code>none</code>, look up <code>n</code> in the current
module's state (the <code>NameMap</code>). If it returns <code>some <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext.idx">idx</a></code>, use <code>ext.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext.idx">idx</a></code> to get
the array of entries for <code>n</code>'s defining module, and query it using <code><a href=".././Init/Data/Array/BinSearch.html#Array.binSearch">Array.binSearch</a></code>. This pattern
imposes a constraint that the extension can only track metadata that is declared in the same module
as the definition to which it applies; relaxing this restriction can make queries slower due to
needing to search <em>all</em> modules. If it is necessary to search all modules, it is usually better to
initialize the state of type <code>σ</code> once from all imported entries and choose a more efficient search
datastructure for it.</p><p>Note that <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntryFn">addEntryFn</a></code> is not in <code><a href=".././Init/System/IO.html#IO">IO</a></code>. This is intentional, and allows us to write simple functions
such as</p><pre><code>def addAlias (env : Environment) (a : Name) (e : Name) : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a> :=
aliasExtension.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">addEntry</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> (a, e)
</code></pre><p>without using <code><a href=".././Init/System/IO.html#IO">IO</a></code>. We have many functions like <code>addAlias</code>.</p><ul class="structure_fields" id="Lean.PersistentEnvExtension.mk"><li id="Lean.PersistentEnvExtension.toEnvExtension" class="structure_field"><div class="structure_field_info">toEnvExtension : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></li><li id="Lean.PersistentEnvExtension.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div></li><li id="Lean.PersistentEnvExtension.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li><li id="Lean.PersistentEnvExtension.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L491-L492">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtensionState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.instInhabitedPersistentEnvExtensionState</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn">#[]</span>, <span class="fn">state</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L494-L502">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getModuleEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L506-L507">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getModuleEntries</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.getModuleEntries</span> <span class="fn">env</span> <span class="fn">m</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">(<span class="fn"><span class="fn"><span class="fn">ext</span>.toEnvExtension</span>.getState</span> <span class="fn">env</span>)</span>.importedEntries</span>.get!</span> <span class="fn">m</span></span></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.getModuleEntries" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.addEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L509-L512">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">addEntry</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <span class="fn">β</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.addEntry" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L515-L516">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Get the current state of the given extension in the given environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.getState</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn"><span class="fn">ext</span>.toEnvExtension</span>.getState</span> <span class="fn">env</span>)</span>.state</span></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.getState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L519-L520">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Set the current state of the given extension in the given environment. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.setState</span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.toEnvExtension</span>.modifyState</span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">ps</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span></span>) =&gt;
    <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn"><span class="fn">ps</span>.importedEntries</span>, <span class="fn">state</span> := <span class="fn">s</span> }</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L523-L524">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Modify the state of the given extension in the given environment by applying the given function. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.modifyState</span> <span class="fn">env</span> <span class="fn">f</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.toEnvExtension</span>.modifyState</span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">ps</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span></span>) =&gt;
    <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn"><span class="fn">ps</span>.importedEntries</span>, <span class="fn">state</span> := <span class="fn"><span class="fn">f</span> <span class="fn"><span class="fn">ps</span>.state</span></span> }</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.persistentEnvExtensionsRef"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L528-L528">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.persistentEnvExtensionsRef"><span class="name">Lean</span>.<span class="name">persistentEnvExtensionsRef</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a>)</span>)</span></span></div></div></div></div><div class="decl" id="Lean.PersistentEnvExtensionDescr"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L530-L536">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionDescr</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(β : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionDescr.mk"><li id="Lean.PersistentEnvExtensionDescr.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div></li><li id="Lean.PersistentEnvExtensionDescr.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtensionDescr" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtensionUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L538-L557">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtensionUnsafe"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtensionUnsafe</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.registerPersistentEnvExtensionUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtension"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L560-L560">source</a></div><div class="attributes">@[implemented_by Lean.registerPersistentEnvExtensionUnsafe]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L563-L563">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Simple <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> that implements <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code> using a list of entries.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">α</span> <span class="fn">(<span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.SimplePersistentEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkStateFromImportedEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L565-L566">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkStateFromImportedEntries"><span class="name">Lean</span>.<span class="name">mkStateFromImportedEntries</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">α</span> → <span class="fn">σ</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(initState : <span class="fn">σ</span>)</span></span>
<span class="decl_args">
<span class="fn">(as : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.mkStateFromImportedEntries">Lean.mkStateFromImportedEntries</a> <span class="fn">addEntryFn</span> <span class="fn">initState</span> <span class="fn">as</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.foldl">Array.foldl</a> <span class="fn">(fun (<span class="fn">r</span> : <span class="fn">σ</span>) (<span class="fn">es</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>) =&gt; <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.foldl">Array.foldl</a> <span class="fn">(fun (<span class="fn">r</span> : <span class="fn">σ</span>) (<span class="fn">e</span> : <span class="fn">α</span>) =&gt; <span class="fn"><span class="fn">addEntryFn</span> <span class="fn">r</span> <span class="fn">e</span></span>)</span> <span class="fn">r</span> <span class="fn">es</span></span>)</span> <span class="fn">initState</span> <span class="fn">as</span></span></span></li></ul></details><details id="instances-for-list-Lean.mkStateFromImportedEntries" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtensionDescr"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L568-L572">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtensionDescr</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.SimplePersistentEnvExtensionDescr.mk"><li id="Lean.SimplePersistentEnvExtensionDescr.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">α</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span> → <span class="fn">σ</span></span></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.toArrayFn" class="structure_field"><div class="structure_field_info">toArrayFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li></ul><details id="instances-for-list-Lean.SimplePersistentEnvExtensionDescr" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerSimplePersistentEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L574-L583">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerSimplePersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerSimplePersistentEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtensionDescr">Lean.SimplePersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.registerSimplePersistentEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.instInhabited"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L587-L588">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.instInhabited"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">instInhabited</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.SimplePersistentEnvExtension.instInhabited</span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> <span class="fn">(<a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">α</span> <span class="fn">(<span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span>)</span>)</span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.getEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L592-L593">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getEntries"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">getEntries</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span></div></div><p>Get the list of values used to update the state of the given
<code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code> in the current file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.getEntries</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span>)</span>.fst</span></span></li></ul></details><details id="instances-for-list-Lean.SimplePersistentEnvExtension.getEntries" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L596-L597">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Get the current state of the given <code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.getState</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span>)</span>.snd</span></span></li></ul></details><details id="instances-for-list-Lean.SimplePersistentEnvExtension.getState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L600-L601">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Set the current state of the given <code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code>. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.setState</span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span></span>) =&gt;
    <span class="fn">match <span class="fn">x</span> with
    | <span class="fn">(<span class="fn">entries</span>, <span class="fn">snd</span>)</span> =&gt; <span class="fn">(<span class="fn">entries</span>, <span class="fn">s</span>)</span></span></span></span></span></li></ul></details><details id="instances-for-list-Lean.SimplePersistentEnvExtension.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L604-L605">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">SimplePersistentEnvExtension</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Modify the state of the given extension in the given environment by applying the given function. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.modifyState</span> <span class="fn">env</span> <span class="fn">f</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span></span>) =&gt;
    <span class="fn">match <span class="fn">x</span> with
    | <span class="fn">(<span class="fn">entries</span>, <span class="fn">s</span>)</span> =&gt; <span class="fn">(<span class="fn">entries</span>, <span class="fn"><span class="fn">f</span> <span class="fn">s</span></span>)</span></span></span></span></span></li></ul></details><details id="instances-for-list-Lean.SimplePersistentEnvExtension.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L611-L611">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Environment extension for tagging declarations.
Declarations must only be tagged in the module where they were declared.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></span></span></li></ul></details><details id="instances-for-list-Lean.TagDeclarationExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkTagDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L613-L619">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkTagDeclarationExtension"><span class="name">Lean</span>.<span class="name">mkTagDeclarationExtension</span></a></span><span class="decl_args">
<span class="fn">(name : <span class="fn"><a href=".././Init/Tactics.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.3302">_auto✝</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkTagDeclarationExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.instInhabited"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L623-L624">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.instInhabited"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">instInhabited</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.TagDeclarationExtension.instInhabited">Lean.TagDeclarationExtension.instInhabited</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> <span class="fn">(<a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a>)</span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.tag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L626-L629">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.tag"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">tag</span></a></span><span class="decl_args">
<span class="fn">(ext : <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.TagDeclarationExtension.tag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.isTagged"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L631-L634">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.isTagged"><span class="name">Lean</span>.<span class="name">TagDeclarationExtension</span>.<span class="name">isTagged</span></a></span><span class="decl_args">
<span class="fn">(ext : <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.TagDeclarationExtension.isTagged" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L641-L641">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Environment extension for mapping declarations to values.
Declarations must only be inserted into the mapping in the module where they were declared.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">(<a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">α</span>)</span> <span class="fn">(<a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lake.NameMap</a> <span class="fn">α</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.MapDeclarationExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkMapDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L643-L649">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkMapDeclarationExtension"><span class="name">Lean</span>.<span class="name">mkMapDeclarationExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(name : <span class="fn"><a href=".././Init/Tactics.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.3458">_auto✝</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkMapDeclarationExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.instInhabited"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L653-L654">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.instInhabited"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">instInhabited</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.MapDeclarationExtension.instInhabited</span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> <span class="fn">(<a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">(<a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">α</span>)</span> <span class="fn">(<a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lake.NameMap</a> <span class="fn">α</span>)</span>)</span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.insert"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L656-L659">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.insert"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">insert</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(val : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.MapDeclarationExtension.insert" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L661-L667">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.find?"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">find?</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.MapDeclarationExtension.find?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.contains"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L669-L672">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.contains"><span class="name">Lean</span>.<span class="name">MapDeclarationExtension</span>.<span class="name">contains</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.MapDeclarationExtension.contains" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.saveModuleData"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L677-L677">source</a></div><div class="attributes">@[extern  lean_save_module_data]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.saveModuleData"><span class="name">Lean</span>.<span class="name">saveModuleData</span></a></span><span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">Lake.FilePath</a>)</span></span>
<span class="decl_args">
<span class="fn">(mod : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(data : <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.readModuleData"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L679-L679">source</a></div><div class="attributes">@[extern  lean_read_module_data]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.readModuleData"><span class="name">Lean</span>.<span class="name">readModuleData</span></a></span><span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">Lake.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a>)</span></span></div></div></div></div><div class="decl" id="Lean.Environment.freeRegions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L685-L701">source</a></div><div class="attributes">@[noinline, export lean_environment_free_regions]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.freeRegions"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">freeRegions</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Free compacted regions of imports. No live references to imported objects may exist at the time of invocation; in
particular, <code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a></code> should be the last reference to any <code><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></code> derived from these imports.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.freeRegions</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.forM">Array.forM</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion.free">Lean.CompactedRegion.free</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.regions</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.freeRegions" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkModuleData"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L703-L714">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkModuleData"><span class="name">Lean</span>.<span class="name">mkModuleData</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.writeModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L717-L718">source</a></div><div class="attributes">@[export lean_write_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.writeModule"><span class="name">Lean</span>.<span class="name">writeModule</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">Lake.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.writeModule">Lean.writeModule</a> <span class="fn">env</span> <span class="fn">fname</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href=".././Lean/Environment.html#Lean.mkModuleData">Lean.mkModuleData</a> <span class="fn">env</span></span>
  <span class="fn"><a href=".././Lean/Environment.html#Lean.saveModuleData">Lean.saveModuleData</a> <span class="fn">fname</span> <span class="fn"><span class="fn">env</span>.mainModule</span> <span class="fn">__do_lift</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.writeModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkExtNameMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L724-L731">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkExtNameMap"><span class="name">Lean</span>.<span class="name">mkExtNameMap</span></a></span><span class="decl_args">
<span class="fn">(startingAt : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span></div></div><p>Construct a mapping from persistent extension name to entension index at the array of persistent extensions.
We only consider extensions starting with index <code>&gt;= startingAt</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkExtNameMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.updateEnvAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L758-L758">source</a></div><div class="attributes">@[extern 2 lean_update_env_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.updateEnvAttributes"><span class="name">Lean</span>.<span class="name">updateEnvAttributes</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></span></div></div><p>&quot;Forward declaration&quot; needed for updating the attribute table with user-defined attributes.
User-defined attributes are declared using the <code>initialize</code> command. The <code>initialize</code> command is just syntax sugar for the <code>init</code> attribute.
The <code>init</code> attribute is initialized after the <code>attributeExtension</code> is initialized. We cannot change the order since the <code>init</code> attribute is an attribute,
and requires this extension.
The <code>attributeExtension</code> initializer uses <code>attributeMapRef</code> to initialize the attribute mapping.
When we a new user-defined attribute declaration is imported, <code>attributeMapRef</code> is updated.
Later, we set this method with code that adds the user-defined attributes that were imported after we initialized <code>attributeExtension</code>.</p></div></div><div class="decl" id="Lean.getNumBuiltinAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L760-L760">source</a></div><div class="attributes">@[extern 1 lean_get_num_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.getNumBuiltinAttributes"><span class="name">Lean</span>.<span class="name">getNumBuiltinAttributes</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div><p>&quot;Forward declaration&quot; for retrieving the number of builtin attributes.</p></div></div><div class="decl" id="Lean.ImportState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L787-L791">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportState"><span class="name">Lean</span>.<span class="name">ImportState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.ImportState.mk"><li id="Lean.ImportState.moduleNameSet" class="structure_field"><div class="structure_field_info">moduleNameSet : <a href=".././Lean/Data/NameMap.html#Lean.NameHashSet">Lean.NameHashSet</a></div></li><li id="Lean.ImportState.moduleNames" class="structure_field"><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span></div></li><li id="Lean.ImportState.moduleData" class="structure_field"><div class="structure_field_info">moduleData : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></li><li id="Lean.ImportState.regions" class="structure_field"><div class="structure_field_info">regions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span></div></li></ul><details id="instances-for-list-Lean.ImportState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.throwAlreadyImported"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L793-L796">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.throwAlreadyImported"><span class="name">Lean</span>.<span class="name">throwAlreadyImported</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(s : <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a>)</span></span>
<span class="decl_args">
<span class="fn">(const2ModIdx : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(modIdx : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(cname : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.throwAlreadyImported" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportStateM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L798-L798">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportStateM"><span class="name">Lean</span>.<span class="name">ImportStateM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">Lean.ImportStateM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href=".././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a> <a href=".././Init/System/IO.html#IO">IO</a></span></span></li></ul></details><details id="instances-for-list-Lean.ImportStateM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportStateM.run"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L800-L801">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportStateM.run"><span class="name">Lean</span>.<span class="name">ImportStateM</span>.<span class="name">run</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(x : <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">Lean.ImportStateM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a> <span class="fn">{ <span class="fn">moduleNameSet</span> := <a href=".././Init/Core.html#EmptyCollection.emptyCollection">∅</a>, <span class="fn">moduleNames</span> := <span class="fn">#[]</span>, <span class="fn">moduleData</span> := <span class="fn">#[]</span>, <span class="fn">regions</span> := <span class="fn">#[]</span> }</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">x</span>.run</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'.run">StateRefT'.run</a> <span class="fn">x</span> <span class="fn">s</span></span></span></li></ul></details><details id="instances-for-list-Lean.ImportStateM.run" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.importModulesCore"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L803-L817">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModulesCore"><span class="name">Lean</span>.<span class="name">importModulesCore</span></a></span><span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">Lean.ImportStateM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.finalizeImport"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L855-L908">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.finalizeImport"><span class="name">Lean</span>.<span class="name">finalizeImport</span></a></span><span class="decl_args">
<span class="fn">(s : <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a>)</span></span>
<span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(leakEnv : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><p>Construct environment from <code><a href=".././Lean/Environment.html#Lean.importModulesCore">importModulesCore</a></code> results.</p><p>If <code>leakEnv</code> is true, we mark the environment as persistent, which means it
will not be freed. We set this when the object would survive until the end of
the process anyway. In exchange, RC updates are avoided, which is especially
important when they would be atomic because the environment is shared across
threads (potentially, storing it in an <code><a href=".././Init/System/IO.html#IO.Ref">IO.Ref</a></code> is sufficient for marking it
as such).</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.finalizeImport" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.importModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L911-L918">source</a></div><div class="attributes">@[export lean_import_modules]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModules"><span class="name">Lean</span>.<span class="name">importModules</span></a></span><span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(leakEnv : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.importModules" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.withImportModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L923-L925">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.withImportModules"><span class="name">Lean</span>.<span class="name">withImportModules</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(act : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><p>Create environment object from imports and free compacted regions after calling <code>act</code>. No live references to the
environment object or imported objects may exist after <code>act</code> finishes.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.withImportModules">Lean.withImportModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">trustLevel</span> <span class="fn">act</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">env</span> ← <span class="fn"><a href=".././Lean/Environment.html#Lean.importModules">Lean.importModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">trustLevel</span></span>
  <span class="fn"><a href=".././Init/Control/Except.html#tryFinally">tryFinally</a> <span class="fn">(<span class="fn">act</span> <span class="fn">env</span>)</span> <span class="fn"><span class="fn">env</span>.freeRegions</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.withImportModules" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.namespacesExt"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L927-L943">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.namespacesExt"><span class="name">Lean</span>.<span class="name">namespacesExt</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSSet">Lean.NameSSet</a></span></div></div><p>Environment extension for tracking all <code>namespace</code> declared by users.</p></div></div><div class="decl" id="Lean.Kernel.Diagnostics"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L945-L950">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Diagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Kernel.Diagnostics.mk"><li id="Lean.Kernel.Diagnostics.unfoldCounter" class="structure_field"><div class="structure_field_info">unfoldCounter : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PHashMap">Lean.PHashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div><div class="structure_field_doc"><p>Number of times each declaration has been unfolded by the kernel.</p></div></li><li id="Lean.Kernel.Diagnostics.enabled" class="structure_field"><div class="structure_field_info">enabled : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>If <code><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.enabled">enabled</a> = true</code>, kernel records declarations that have been unfolded.</p></div></li></ul><details id="instances-for-list-Lean.Kernel.Diagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.instInhabitedDiagnostics"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L950-L950">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instInhabitedDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.instInhabitedDiagnostics">Lean.Kernel.instInhabitedDiagnostics</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">unfoldCounter</span> := <span class="fn">default</span>, <span class="fn">enabled</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.diagExt"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L952-L962">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.diagExt"><span class="name">Lean</span>.<span class="name">diagExt</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a></span></div></div><p>Extension for storting diagnostic information.</p><p>Remark: We store kernel diagnostic information in an environment extension to simplify
the interface with the kernel implemented in C/C++. Thus, we can only track
declarations in methods, such as <code>addDecl</code>, which return a new environment.
<code><a href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Kernel.isDefEq</a></code> and <code><a href=".././Lean/Environment.html#Lean.Kernel.whnf">Kernel.whnf</a></code> do not update the statistics. We claim
this is ok since these methods are mainly used for debugging.</p></div></div><div class="decl" id="Lean.Kernel.Diagnostics.isEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L965-L966">source</a></div><div class="attributes">@[export lean_kernel_diag_is_enabled]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.isEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span>.<span class="name">isEnabled</span></a></span><span class="decl_args">
<span class="fn">(d : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">d</span>.isEnabled</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">d</span>.enabled</span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.Diagnostics.isEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.enableDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L969-L970">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">enableDiag</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(flag : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Enables/disables kernel diagnostics.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.enableDiag">Lean.Kernel.enableDiag</a> <span class="fn">env</span> <span class="fn">flag</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.diagExt">Lean.diagExt</a>.modifyState</span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">s</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a>) =&gt;
    <span class="fn">{ <span class="fn">unfoldCounter</span> := <span class="fn"><span class="fn">s</span>.unfoldCounter</span>, <span class="fn">enabled</span> := <span class="fn">flag</span> }</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.enableDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.isDiagnosticsEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L972-L973">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDiagnosticsEnabled</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDiagnosticsEnabled">Lean.Kernel.isDiagnosticsEnabled</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.diagExt">Lean.diagExt</a>.getState</span> <span class="fn">env</span>)</span>.enabled</span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.isDiagnosticsEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.resetDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L975-L976">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">resetDiag</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.resetDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Diagnostics.recordUnfold"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L979-L984">source</a></div><div class="attributes">@[export lean_kernel_record_unfold]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.recordUnfold"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span>.<span class="name">recordUnfold</span></a></span><span class="decl_args">
<span class="fn">(d : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.Diagnostics.recordUnfold" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.getDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L987-L988">source</a></div><div class="attributes">@[export lean_kernel_get_diag]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">getDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.getDiagnostics">Lean.Kernel.getDiagnostics</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.diagExt">Lean.diagExt</a>.getState</span> <span class="fn">env</span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.getDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.setDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L991-L992">source</a></div><div class="attributes">@[export lean_kernel_set_diag]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">setDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(diag : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Lean.Kernel.Diagnostics</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.setDiagnostics">Lean.Kernel.setDiagnostics</a> <span class="fn">env</span> <span class="fn">diag</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.diagExt">Lean.diagExt</a>.setState</span> <span class="fn">env</span> <span class="fn">diag</span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.setDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.registerNamespace"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L997-L998">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.registerNamespace"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">registerNamespace</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Register a new namespace in the environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.registerNamespace</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">if <span class="fn"><span class="fn"><span class="fn"><span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a>.getState</span> <span class="fn">env</span>)</span>.contains</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn">env</span>
  else <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">Lean.PersistentEnvExtension.addEntry</a> <a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a> <span class="fn">env</span> <span class="fn">n</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.registerNamespace" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isNamespace"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1001-L1002">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isNamespace"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isNamespace</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Return <code>true</code> if <code>n</code> is the name of a namespace in <code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.isNamespace</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a>.getState</span> <span class="fn">env</span>)</span>.contains</span> <span class="fn">n</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.isNamespace" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.getNamespaceSet"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1005-L1006">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getNamespaceSet"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getNamespaceSet</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Data/NameMap.html#Lean.NameSSet">Lean.NameSSet</a></div></div><p>Return a set containing all namespaces in <code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.getNamespaceSet</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a>.getState</span> <span class="fn">env</span></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.getNamespaceSet" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.displayStats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1023-L1036">source</a></div><div class="attributes">@[export lean_display_stats]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.displayStats"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">displayStats</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.displayStats" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.evalConst"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1043-L1043">source</a></div><div class="attributes">@[extern  lean_eval_const]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConst</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a> u_1)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(constName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Init/Prelude.html#String">String</a> <span class="fn">α</span></span></div></div><p>Evaluate the given declaration under the given environment to a value of the given type.
This function is only safe to use if the type matches the declaration's type in the environment
and if <code>enableInitializersExecution</code> has been used before importing any modules.</p></div></div><div class="decl" id="Lean.Environment.evalConstCheck"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1050-L1058">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConstCheck"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConstCheck</span></a></span><span class="decl_args">
<span class="fn">(α : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(typeName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(constName : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Control/Except.html#ExceptT">ExceptT</a> <a href=".././Init/Prelude.html#String">String</a> <a href=".././Init/Control/Id.html#Id">Id</a> <span class="fn">α</span></span></div></div><p>Like <code><a href=".././Lean/Environment.html#Lean.Environment.evalConst">evalConst</a></code>, but first check that <code>constName</code> indeed is a declaration of type <code>typeName</code>.
Note that this function cannot guarantee that <code>typeName</code> is in fact the name of the type <code>α</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.evalConstCheck" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.hasUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1060-L1067">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.hasUnsafe"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">hasUnsafe</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.hasUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Kernel-API">Kernel API <a class="hover-link" href="#Kernel-API">#</a></h1></div><div class="decl" id="Lean.Kernel.isDefEq"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1079-L1079">source</a></div><div class="attributes">@[extern  lean_kernel_is_def_eq]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEq"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEq</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Kernel isDefEq predicate. We use it mainly for debugging purposes.
Recall that the Kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.Kernel.isDefEqGuarded"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1081-L1082">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEqGuarded</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded">Lean.Kernel.isDefEqGuarded</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Lean.Kernel.isDefEq</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> with
  | <span class="fn"><a href=".././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">result</span></span> =&gt; <span class="fn">result</span>
  | <span class="fn">x</span> =&gt; <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.isDefEqGuarded" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.whnf"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1089-L1089">source</a></div><div class="attributes">@[extern  lean_kernel_whnf]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.whnf"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">whnf</span></a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Kernel WHNF function. We use it mainly for debugging purposes.
Recall that the Kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.MonadEnv"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1093-L1095">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MonadEnv"><span class="name">Lean</span>.<span class="name">MonadEnv</span></a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.MonadEnv.mk"><li id="Lean.MonadEnv.getEnv" class="structure_field"><div class="structure_field_info">getEnv : <span class="fn"><span class="fn">m</span> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></li><li id="Lean.MonadEnv.modifyEnv" class="structure_field"><div class="structure_field_info">modifyEnv : <span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.MonadEnv" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.instMonadEnvOfMonadLift"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1100-L1102">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instMonadEnvOfMonadLift"><span class="name">Lean</span>.<span class="name">instMonadEnvOfMonadLift</span></a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(n : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#MonadLift">MonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">n</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.instMonadEnvOfMonadLift">Lean.instMonadEnvOfMonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">getEnv</span> := <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">Lean.getEnv</span></span>,
    <span class="fn">modifyEnv</span> := <span class="fn">fun (<span class="fn">f</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span>) =&gt; <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.MonadEnv.modifyEnv">Lean.modifyEnv</a> <span class="fn">f</span>)</span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.mkDefinitionValInferrringUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ec3042d94bd11a42430f9e14d39e26b1f880f99b/src/Lean/Environment.lean#L1105-L1109">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkDefinitionValInferrringUnsafe"><span class="name">Lean</span>.<span class="name">mkDefinitionValInferrringUnsafe</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(name : <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(levelParams : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Lake.Name</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(type : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(value : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(hints : <a href=".././Lean/Declaration.html#Lean.ReducibilityHints">Lean.ReducibilityHints</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/Declaration.html#Lean.DefinitionVal">Lean.DefinitionVal</a></span></div></div><p>Constructs a DefinitionVal, inferring the <code>unsafe</code> field</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkDefinitionValInferrringUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src=".././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>